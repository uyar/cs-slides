% Copyright (c) 2002-2014
%       H. Turgut Uyar <uyar@itu.edu.tr>
%       Şule Gündüz Öğüdücü <sgunduz@itu.edu.tr>
%
% This work is licensed under a "Creative Commons
% Attribution-NonCommercial-ShareAlike 4.0 International License".
% For more information, please visit:
% https://creativecommons.org/licenses/by-nc-sa/4.0/

\documentclass[dvipsnames]{beamer}

\usepackage{ae}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\setbeamertemplate{navigation symbols}{}
\setbeamersize{text margin left=2em, text margin right=2em}
\usepackage[labelformat=empty, aboveskip=1pt, belowskip=1pt]{caption}

\usepackage{listings}
\lstdefinelanguage{TutorialD}[]{}{
  morekeywords={AND, AS, BASE, BOOL, CAST_AS_, CAST_AS_RATIONAL, CHAR,
                CONSTRAINT, DELETE, DIVIDEBY, DROP, INSERT, INTEGER, INTERSECT,
                JOIN, KEY, MINUS, OR, PER, POSSREP, RATIONAL, RELATION, RENAME,
                THE_, TUPLE, TYPE, UNION, UPDATE, VAR, WHERE}
}
\lstset{basicstyle=\ttfamily, keywordstyle=\color{blue}, showstringspaces=false}

\mode<presentation>
{
  \usetheme{Warsaw}
  \usecolortheme[named=ForestGreen]{structure}
  \setbeamercovered{transparent}
}

\title{Database Systems}
\subtitle{Relational Model}

\author{H. Turgut Uyar \and Şule Öğüdücü}
\date{2002-2014}

\AtBeginSubsection[]{
  \begin{frame}<beamer>
    \frametitle{Topics}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}

\theoremstyle{plain}

\pgfdeclareimage[width=2cm]{license}{../license}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{License}

  \pgfuseimage{license}\hfill
  \copyright~2002-2014 T. Uyar, Ş. Öğüdücü

  \vfill
  \begin{footnotesize}
    You are free to:
    \begin{itemize}
      \itemsep0em
      \item Share -- copy and redistribute the material in any medium or format
      \item Adapt -- remix, transform, and build upon the material
    \end{itemize}

    Under the following terms:
    \begin{itemize}
      \itemsep0em
      \item Attribution -- You must give appropriate credit, provide a link to
        the license, and indicate if changes were made.

      \item NonCommercial -- You may not use the material for commercial
        purposes.

      \item ShareAlike -- If you remix, transform, or build upon the material,
        you must distribute your contributions under the same license as the
        original.
    \end{itemize}
  \end{footnotesize}

  \begin{small}
    For more information:\\
    \url{https://creativecommons.org/licenses/by-nc-sa/4.0/}

    \smallskip
    Read the full license:\\
    \url{https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode}
  \end{small}
\end{frame}

\begin{frame}
  \frametitle{Topics}
  \tableofcontents
\end{frame}

\section{Relational Model}

\subsection{Introduction}

\begin{frame}
  \frametitle{Data Models}

  \begin{itemize}
    \item previous models:
    \begin{itemize}
      \item inverted list
      \item hierarchical
      \item network
    \end{itemize}

    \pause
    \item relational model:
    \begin{itemize}
      \item Dr. E. F. Codd, 1970
    \end{itemize}

    \pause
    \item later models:
    \begin{itemize}
      \item object
      \item object / relational
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Relational Model}

  \begin{itemize}
    \item data is modelled as \alert{relations}:\\
      $\alpha \subseteq A \times B \times C \times ...$

    \pause
    \medskip
    \item relations are assigned to \alert{relation variables} (relvar)
    \item each element of a relation is a \alert{tuple}
    \item each piece of data of an element is an \alert{attribute}

    \pause
    \medskip
    \item relations are represented using tables
    \item relation $\rightarrow$ table, tuple $\rightarrow$ row,
      attribute $\rightarrow$ column
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Relation Example}

  \begin{footnotesize}
  \begin{table}
    \caption{MOVIE}
    \begin{tabular}{|l|r|l|r|r|}\hline
TITLE                & YEAR & DIRECTOR      & SCORE & VOTES\\\hline\hline
Usual Suspects       & 1995 & Bryan Singer  &   8.7 &  3502\\\hline
Suspiria             & 1977 & Dario Argento &   7.1 &  1004\\\hline
Being John Malkovich & 1999 & Spike Jonze   &   8.3 & 13809\\\hline
...                  &  ... & ...           &   ... &   ...\\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}

  \begin{itemize}
    \item the name of the relation variable is \texttt{MOVIE}
    \item \texttt{(Usual Suspects, 1995, Bryan Singer, 8.7, 3502)}\\
      is a tuple
    \item \texttt{YEAR} is an attribute
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Relation Structure}

    \begin{itemize}
      \item relation header:
      \begin{itemize}
        \item the set of attributes of the relation
        \item affected by data definition language statements
      \end{itemize}

      \pause
      \medskip
      \item relation body:
      \begin{itemize}
        \item the set of tuples in the relation
        \item affected by data manipulation language statements
      \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Relation Predicate}

  \begin{itemize}
    \item \alert{relation predicate}:\\
      the sentence expressing the "meaning" of the relation
    \item each tuple is either \emph{True} or \emph{False} according to the
      predicate
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Relation Predicate Example}

  \begin{itemize}
    \item The movie with the title \texttt{TITLE} was released in the year
      \texttt{YEAR}.\\
      It was directed by the director \texttt{DIRECTOR}.\\
      The average of \texttt{VOTES} votes is \texttt{SCORE}.

    \pause
    \medskip
    \item \texttt{(Suspiria, 1977, Dario Argento, 1004, 7.1)} is True
    \item \texttt{(Suspiria, 1978, Dario Argento, 1004, 7.1)} is False
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Tuple Order}

  \begin{itemize}
    \item the order of tuples is insignificant
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item the following two relations are equivalent:
    \end{itemize}

    \begin{columns}
      \column{.5\textwidth}
      \begin{footnotesize}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|l|l|}\hline
TITLE                & ...\\\hline\hline
Usual Suspects       & ...\\\hline
Suspiria             & ...\\\hline
Being John Malkovich & ...\\\hline
        \end{tabular}
      \end{table}
      \end{footnotesize}

      \column{.5\textwidth}
      \begin{footnotesize}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|l|l|}\hline
TITLE                & ...\\\hline\hline
Suspiria             & ...\\\hline
Being John Malkovich & ...\\\hline
Usual Suspects       & ...\\\hline
        \end{tabular}
      \end{table}
      \end{footnotesize}
    \end{columns}
  \end{example}
\end{frame}

\begin{frame}
  \frametitle{Attribute Order}

  \begin{itemize}
    \item the order of attributes is insignificant
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item the following two relations are equivalent:
    \end{itemize}

    \begin{columns}
      \column{.4\textwidth}
      \begin{footnotesize}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|l|r|l|}\hline
TITLE          & YEAR & ...\\\hline\hline
Usual Suspects & 1995 & ...\\\hline
Suspiria       & 1977 & ...\\\hline
        \end{tabular}
      \end{table}
      \end{footnotesize}

      \column{.4\textwidth}
      \begin{footnotesize}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|r|l|l|}\hline
YEAR & TITLE                & ...\\\hline\hline
1995 & Usual Suspects       & ...\\\hline
1977 & Suspiria             & ...\\\hline
        \end{tabular}
      \end{table}
      \end{footnotesize}
    \end{columns}
  \end{example}
\end{frame}

\begin{frame}
  \frametitle{Duplicate Tuples}

  \begin{itemize}
    \item there can not be duplicate tuples in a relation
    \item each tuple must be uniquely identifiable
  \end{itemize}

  \begin{example}
    \begin{footnotesize}
    \begin{table}
      %\caption{MOVIE}
      \begin{tabular}{|l|r|l|r|r|}\hline
TITLE                & YEAR & DIRECTOR      & SCORE & VOTES\\\hline\hline
Usual Suspects       & 1995 & Bryan Singer  &   8.7 &  3502\\\hline
Suspiria             & 1977 & Dario Argento &   7.1 &  1004\\\hline
Being John Malkovich & 1999 & Spike Jonze   &   8.3 & 13809\\\hline
...                  &  ... & ...           &   ... &   ...\\\hline
Suspiria             & 1977 & Dario Argento &   7.1 &  1004\\\hline
...                  &  ... & ...           &   ... &   ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}
  \end{example}

  \begin{picture}(20,40)(27,-70)
    \color[rgb]{1,0.2,0.1}
    \put(20,25){\vector(3,-2){25}}
    \put(20,25){\vector(3,2){25}}
  \end{picture}
\end{frame}

\begin{frame}
  \frametitle{Domains}

  \begin{itemize}
    \item all values for the same attribute have to be selected\\
      from the same domain
    \begin{itemize}
      \item comparison only makes sense between values\\
        chosen from the same domain
    \end{itemize}

    \medskip
    \item in practice, data types are used instead
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Domain Example}

  \begin{itemize}
    \item \texttt{TITLE} from the titles domain, \texttt{YEAR} from the years
      domain,\\
      \texttt{DIRECTOR} from the directors domain, ...

    \pause
    \item if data types are used:\\
      \texttt{TITLE} string, \texttt{YEAR} integer, \texttt{DIRECTOR} string,
        ...

    \begin{itemize}
      \item assigning the value \texttt{"Usual Suspects"} to the attribute
        \texttt{DIRECTOR} is correct in terms of data types\\
        but it doesn't make sense

      \item \texttt{YEAR} and \texttt{VOTES} are integers\\
        but it doesn't make sense to compare them
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Attribute Values}

  \begin{itemize}
    \item attribute values must be scalar
    \item arrays, lists, records etc. are not allowed
  \end{itemize}

  \begin{example}[multiple directors]
    \begin{footnotesize}
    \begin{table}
%       \caption{MOVIE}
      \begin{tabular}{|l|l|l|l|}\hline
TITLE      & ... & DIRECTORS                      & ...\\[2pt]\hline\hline
...        & ... & ...                            & ...\\\hline
The Matrix & ... & Andy Wachowski, Lana Wachowski & ...\\\hline
...        & ... & ...                            & ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \pause
    \begin{picture}(0,0)(-120,-30)
      \color[rgb]{1,0.2,0.1}
      \thicklines
      \only<2->{
        \put(0,0){\line(1,0){135}}
      }
    \end{picture}
  \end{example}
\end{frame}

\begin{frame}
  \frametitle{Null Value}

  \begin{columns}[t]
    \column{.5\textwidth}
    \begin{itemize}
      \item the value of the attribute\\
	is not known for this tuple
    \end{itemize}

    \begin{example}
      \begin{itemize}
        \item the director of the movie\\
	  is not known
      \end{itemize}
    \end{example}

    \pause
    \column{.5\textwidth}
    \begin{itemize}
      \item this tuple does not have\\
        a value for this attribute
    \end{itemize}

    \begin{example}
      \begin{itemize}
        \item nobody voted for the movie,\\
	  therefore there is no \texttt{SCORE}
      \end{itemize}
    \end{example}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Default Value}

  \begin{itemize}
    \item a default value can be used instead of null
    \item it may not be one of the valid values for the attribute
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item if \texttt{SCORE} values are between 1.0 and 10.0,\\
	the default value can be chosen as \texttt{0.0}
    \end{itemize}
  \end{example}
\end{frame}

\subsection{Keys}

\begin{frame}
  \frametitle{Keys}

  \begin{itemize}
    \item let $B$ be the set of all attributes of the relation,\\
      and let $A \subseteq B$

    \pause
    \bigskip
    \item to be a candidate key, $A$ has to be:
    \smallskip
    \item \alert{unique}: no two tuples have the same values\\
      for all attributes in $A$
    \item \alert{irreducible}: no subset of $A$ is unique

    \pause
    \bigskip
    \item every relation has at least one candidate key
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Candidate Key Examples}

  \begin{itemize}
    \item \texttt{\{TITLE\}}

    \pause
    \item \texttt{\{TITLE, YEAR\}}

    \pause
    \item \texttt{\{TITLE, DIRECTOR\}}

    \pause
    \item \texttt{\{TITLE, YEAR, DIRECTOR\}}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Surrogate Keys}

  \begin{itemize}
    \item if a \alert{natural key} can not be found\\
      a \alert{surrogate key} can be defined

    \pause
    \medskip
    \item identity attribute
    \item its value doesn't matter
    \item it can be generated by the system
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Surrogate Key Example}

    \begin{footnotesize}
    \begin{table}
      %\caption{MOVIE}
      \begin{tabular}{|r|l|r|l|r|r|}\hline
MOVIE\# & TITLE                & YEAR & DIRECTOR      & SCORE & VOTES\\\hline\hline
    ... & ...                  &  ... & ...           &   ... &   ...\\\hline
      6 & Usual Suspects       & 1995 & Bryan Singer  &   ... &   ...\\\hline
   1512 & Suspiria             & 1977 & Dario Argento &   ... &   ...\\\hline
     70 & Being John Malkovich & 1999 & Spike Jonze   &   ... &   ...\\\hline
    ... & ...                  &  ... & ...           &   ... &   ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \begin{itemize}
      \item \texttt{\{MOVIE\#\}} is a candidate key
      \item \texttt{\{MOVIE\#, TITLE\}} is not a candidate key
    \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Primary Key}

  \begin{itemize}
    \item if a relation has more than one candidate key,\\
      one of them is selected as the \alert{primary key}
    \begin{itemize}
      \item the others are alternate keys
      \item the names of the attributes in the primary key are underlined
    \end{itemize}

    \medskip
    \item every relation must have a primary key

    \pause
    \medskip
    \item any attribute that is part of the primary key\\
      can not be empty in any tuple
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Primary Key Example}

  \begin{footnotesize}
  \begin{table}
    %\caption{MOVIE}
    \begin{tabular}{|r|l|r|l|r|r|}\hline
\underline{MOVIE\#} & TITLE & YEAR & DIRECTOR      & SCORE & VOTES\\[2pt]\hline\hline
 ... & ...                  &  ... & ...           &   ... &   ...\\\hline
   6 & Usual Suspects       & 1995 & Bryan Singer  &   ... &   ...\\\hline
1512 & Suspiria             & 1977 & Dario Argento &   ... &   ...\\\hline
  70 & Being John Malkovich & 1999 & Spike Jonze   &   ... &   ...\\\hline
 ... & ...                  &  ... & ...           &   ... &   ...\\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}
\end{frame}

\subsection{Referential Integrity}

\begin{frame}
  \frametitle{Scalarity}

  \begin{example}[how to store actor data?]
    \begin{footnotesize}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|l|}\hline
\underline{MOVIE\#} & TITLE    & ... & ACTORS                      \\[2pt]\hline\hline
      6 & Usual Suspects       & ... & Gabriel Byrne               \\\hline
    ... & ...                  & ... & ...                         \\\hline
     70 & Being John Malkovich & ... & Cameron Diaz, John Malkovich\\\hline
    ... & ...                  & ... & ...                         \\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \pause
    \begin{picture}(0,0)(-180,-30)
      \color[rgb]{1,0.2,0.1}
      \thicklines
      \only<2->{
        \put(0,0){\line(1,0){125}}
      }
    \end{picture}
  \end{example}
\end{frame}

\begin{frame}
  \frametitle{Scalarity}

  \begin{itemize}
    \item to meet the scalarity requirement,
      tuples have to be repeated
  \end{itemize}

  \begin{example}[how to store actor data?]
    \begin{footnotesize}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|l|}\hline
MOVIE\# & TITLE                & ... & ACTOR         \\\hline\hline
      6 & Usual Suspects       & ... & Gabriel Byrne \\\hline
    ... & ...                  & ... & ...           \\\hline
     70 & Being John Malkovich & ... & Cameron Diaz  \\\hline
     70 & Being John Malkovich & ... & John Malkovich\\\hline
    ... & ...                  & ... & ...           \\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}
  \end{example}
\end{frame}

\begin{frame}
  \frametitle{Scalarity Example}

  \begin{footnotesize}
  \begin{table}
    \caption{MOVIE}
    \begin{tabular}{|r|l|c|}\hline
\underline{MOVIE\#} & TITLE                & ...\\[2pt]\hline\hline
                  6 & Usual Suspects       & ...\\\hline
               1512 & Suspiria             & ...\\\hline
                 70 & Being John Malkovich & ...\\\hline
                ... & ...                  & ...\\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}

  \vspace{-12pt}
  \begin{columns}[t]
    \column{.5\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{ACTOR}
      \begin{tabular}{|r|l|}\hline
\underline{ACTOR\#} & NAME          \\[2pt]\hline\hline
                308 & Gabriel Byrne \\\hline
                282 & Cameron Diaz  \\\hline
                503 & John Malkovich\\\hline
                ... & ...           \\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \column{.5\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{CASTING}
      \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
                  6 &                 308 &   2\\\hline
                 70 &                 282 &   2\\\hline
                 70 &                 503 &  14\\\hline
                ... &                 ... & ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Scalarity Example}

  \vspace{-12pt}
  \begin{footnotesize}
  \begin{table}
    \caption{MOVIE}
    \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE                & ... & DIRECTOR\#\\[2pt]\hline\hline
                  6 & Usual Suspects       & ... &        639\\\hline
               1512 & Suspiria             & ... &       2259\\\hline
                 70 & Being John Malkovich & ... &       1485\\\hline
                ... & ...                  & ... &        ...\\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}

  \vspace{-24pt}
  \begin{columns}[t]
    \column{.5\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{PERSON}
      \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME          \\[2pt]\hline\hline
                 308 & Gabriel Byrne \\\hline
                1485 & Spike Jonze   \\\hline
                 639 & Bryan Singer  \\\hline
                 282 & Cameron Diaz  \\\hline
                2259 & Dario Argento \\\hline
                 503 & John Malkovich\\\hline
                 ... & ...           \\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \column{.5\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{CASTING}
      \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
                  6 &                 308 &   2\\\hline
                 70 &                 282 &   2\\\hline
                 70 &                 503 &  14\\\hline
                ... &                 ... & ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Foreign Keys}

  \begin{itemize}
    \item \alert{foreign key}: an attribute of a relation\\
      that is a candidate key of another relation
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Foreign Key Example}

  \vspace{-12pt}
  \begin{footnotesize}
  \begin{table}
    \caption{MOVIE}
    \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\#\\[2pt]\hline\hline
   6 & Usual Suspects       & ... &        639\\\hline
1512 & Suspiria             & ... &       2259\\\hline
  70 & Being John Malkovich & ... &       1485\\\hline
 ... & ...                  & ... &        ...\\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}

  \vspace{-6pt}
  \begin{footnotesize}
  \begin{table}
    \caption{PERSON}
    \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
 308 & Gabriel Byrne \\\hline
1485 & Spike Jonze   \\\hline
 639 & Bryan Singer  \\\hline
 282 & Cameron Diaz  \\\hline
2259 & Dario Argento \\\hline
 503 & John Malkovich\\\hline
 ... & ...           \\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}

%   \begin{picture}(100,50)(-140,-90)
%     \color[rgb]{0.1,0.6,0.1}
%     \thicklines
%     \only<2->{
%       \put(22,22){\oval(20,8)}       % movie.director#=2259
%       \put(101,0){\oval(20,8)}       % person.person#=2259
%       \put(32,21){\vector(3,-1){58}} % movie.director#=2259->person.person#=2259
%     }
%     \only<3->{
%       \put(10,41){\oval(45,9)}       % movie.director#
%       \put(92,41){\oval(36,9)}       % person.person#
%       \put(32,41){\vector(1,0){42}}  % movie.director#->person.person#
%     }
%   \end{picture}
\end{frame}

\begin{frame}
  \frametitle{Foreign Key Examples}

  \begin{columns}
    \column{.63\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\#\\[2pt]\hline\hline
         6 & Usual Suspects & ... &        639\\\hline
      1512 & Suspiria       & ... &       2259\\\hline
       ... & ...            & ... &        ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \column{.37\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{PERSON}
      \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
        308 & Gabriel Byrne\\\hline
       1485 & Spike Jonze  \\\hline
        ... & ...          \\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}
  \end{columns}

  \begin{footnotesize}
  \begin{table}
    \caption{CASTING}
    \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
                  6 &                 308 &   2\\\hline
                 70 &                 282 &   2\\\hline
                ... &                 ... & ...\\\hline
    \end{tabular}
  \end{table}
  \end{footnotesize}

%   \begin{picture}(240,80)(-42,-138)
%     \color[rgb]{0.1,0.6,0.1}
%     \thicklines
%     \only<2->{
%       \put(116,78){\oval(45,9)}        % movie.director#
%       \put(211,78){\oval(36,9)}        % person.person#
%       \put(138,78){\vector(1,0){54}}   % movie.director#->person.person#
%     }
%     \only<3->{
%       \put(97,4){\oval(33,9)}          % casting.movie#
%       \put(3,77){\oval(33,9)}          % movie.movie#
%       \put(96,9){\vector(-4,3){83}}    % casting.movie#->movie.movie#
%     }
%     \only<4->{
%       \put(136,4){\oval(35,9)}         % casting.actor#
%       \put(150,9){\vector(3,4){48}}    % casting.actor#->person.person#
%     }
%   \end{picture}
\end{frame}

\begin{frame}
  \frametitle{Referential Integrity}

  \begin{itemize}
    \item \alert{referential integrity}:\\
      all values of a foreign key attribute must be present\\
      in the corresponding attribute of the referenced relation

    \medskip
    \item prevent requests that break referential integrity
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Referential Integrity Examples}

  \begin{columns}
    \column{.5\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\#\\[2pt]\hline\hline
             ... & ...      & ... &        ...\\\hline
            1512 & Suspiria & ... &       2259\\\hline
             ... & ...      & ... &        ...\\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}

    \column{.5\textwidth}
    \begin{footnotesize}
    \begin{table}
      \caption{PERSON}
      \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
        ... & ...          \\\hline
       2259 & Dario Argento\\\hline
        ... & ...          \\\hline
      \end{tabular}
    \end{table}
    \end{footnotesize}
  \end{columns}

  \begin{itemize}
    \item delete the tuple \texttt{(2259, Dario Argento)}
    \item update the tuple \texttt{(2259, Dario Argento)}\\
      as \texttt{(2871,Dario Argento)}
  \end{itemize}
\end{frame}

\subsection{TutorialD}

\lstset{language=TutorialD}

\begin{frame}
  \frametitle{Tutorial D Data Types}

  \begin{itemize}
    \item \texttt{INTEGER}
    \item \texttt{RATIONAL}
    \item \texttt{BOOL}
    \item \texttt{CHAR}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Type Definition}

  \begin{itemize}
    \item defining a new type:
    \begin{lstlisting}
TYPE type_name POSSREP {
  field_name field_type
  [, ...]
};
    \end{lstlisting}

    \item deleting a type:
    \begin{lstlisting}
DROP TYPE type_name;
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Type Definition Examples}

  \begin{lstlisting}
TYPE MOVIE# POSSREP { VALUE INTEGER };

TYPE YEAR POSSREP { VALUE INTEGER };

TYPE SCORE POSSREP { VALUE RATIONAL };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Type Operations}

  \begin{itemize}
    \item generating a value for a type:
    \begin{lstlisting}
type_name(base_value [, ...])
    \end{lstlisting}
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item generating a \texttt{SCORE} value:
      \begin{lstlisting}
SCORE(8.7)
      \end{lstlisting}
    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Type Operations}

  \begin{itemize}
    \item getting the value of a field: \lstinline!THE_! operators
    \begin{lstlisting}
THE_field_name(variable_name)
    \end{lstlisting}
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item getting the \texttt{VALUE} field of a \texttt{SCORE} variable:
      \begin{lstlisting}
THE_VALUE(SCORE)
      \end{lstlisting}
    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Type Operations}

  \begin{itemize}
    \item type casting: \lstinline!CAST_AS_! operators
    \begin{lstlisting}
CAST_AS_target_type(value)
    \end{lstlisting}
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item casting an integer \texttt{VOTES} value to a \texttt{RATIONAL}:
      \begin{lstlisting}
CAST_AS_RATIONAL(VOTES)
      \end{lstlisting}
    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Type Operations}

  \begin{itemize}
    \item renaming an attribute:
    \begin{lstlisting}
RENAME (attribute_name AS new_name)
    \end{lstlisting}
  \end{itemize}

  \begin{example}
    \begin{itemize}
      \item renaming the \texttt{MOVIE\#} attribute:
      \begin{lstlisting}
RENAME (MOVIE# AS MOVIENO)
      \end{lstlisting}
    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Value Constraints}

  \begin{itemize}
    \item defining a value constraint:
    \begin{lstlisting}
TYPE type_name POSSREP {
  field_name field_type
  [, ...]
  CONSTRAINT condition
};
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Value Constraint Example}

  \begin{itemize}
    \item \texttt{SCORE} values must be between \texttt{1.0} and \texttt{10.0}
    \begin{lstlisting}
TYPE SCORE POSSREP {
  VALUE RATIONAL
  CONSTRAINT
    (VALUE >= 1.0) AND (VALUE <= 10.0)
};
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Relation Definition}

  \begin{itemize}
    \item defining a new relation:
    \begin{lstlisting}
RELATION
  { attribute_name attribute_type
    [, ...] }
  KEY { attribute_name [, ...] }
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Relation Definition Example}

  \begin{lstlisting}
RELATION
  { MOVIE# MOVIE#,
    TITLE CHAR,
    YEAR YEAR,
    DIRECTOR CHAR,
    SCORE SCORE,
    VOTES INTEGER }
  KEY { MOVIE# }
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Relation Variables}

  \begin{itemize}
    \item defining a new relation variable
    \begin{lstlisting}
VAR relvar_name BASE RELATION
  { ... }
  KEY { ... };
    \end{lstlisting}

    \item deleting a relation variable:
    \begin{lstlisting}
DROP VAR relvar_name;
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Relation Variable Example}

  \begin{lstlisting}
VAR MOVIE BASE RELATION
  { MOVIE# MOVIE#,
    TITLE CHAR,
    YEAR YEAR,
    DIRECTOR CHAR,
    SCORE SCORE,
    VOTES INTEGER }
  KEY { MOVIE# };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Generation}

  \begin{itemize}
    \item generating a tuple:
    \begin{lstlisting}
TUPLE {
  attribute_name attribute_value
  [, ...]
}
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Generation Example}

  \begin{lstlisting}
TUPLE { MOVIE# MOVIE#(6),
  TITLE "Usual Suspects",
  YEAR YEAR(1995), DIRECTOR "Bryan Singer",
  SCORE SCORE(8.7), VOTES 35027 }
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Relation Generation}

  \begin{itemize}
    \item generating a relation:
    \begin{lstlisting}
RELATION {
  TUPLE { ... }
  [, ...]
}
    \end{lstlisting}

    \item assigning a relation to a relation variable:
    \begin{lstlisting}
relvar_name := RELATION { ... };
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Relation Assignment Example}

  \begin{lstlisting}
MOVIE := RELATION {
  TUPLE { MOVIE# MOVIE#(6),
    TITLE "Usual Suspects",
    YEAR YEAR(1995), DIRECTOR "Bryan Singer",
    SCORE SCORE(8.7), VOTES 35027 },
  TUPLE { MOVIE# MOVIE#(70),
    TITLE "Being John Malkovich",
    YEAR YEAR(1999), DIRECTOR "Spike Jonze",
    SCORE SCORE(8.3), VOTES 13809 }
};
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Insertion}

  \begin{itemize}
    \item inserting tuples:
    \begin{lstlisting}
INSERT relvar_name RELATION {
  TUPLE { ... }
  [, ...]
};
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Insertion Example}

  \begin{lstlisting}
INSERT MOVIE RELATION {
  TUPLE { MOVIE# MOVIE#(6),
    TITLE "Suspiria",
    YEAR YEAR(1977),
    DIRECTOR "Dario Argento",
    SCORE SCORE(7.1), VOTES 1004 }
};
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Deletion}

  \begin{itemize}
    \item deleting tuples:
    \begin{lstlisting}
DELETE relvar_name
  [ WHERE condition ];
    \end{lstlisting}

    \item if no condition is specified, all tuples will be deleted
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Deletion Example}

  \begin{itemize}
    \item delete movies with scores less than 3.0 and votes more than 4
    \begin{lstlisting}
DELETE MOVIE
  WHERE ((SCORE < SCORE(3.0))
     AND (VOTES > 4));
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Update}

  \begin{itemize}
    \item updating tuples:
    \begin{lstlisting}
UPDATE relvar_name
  [ WHERE condition ]
  ( attribute_name := attribute_value
    [, ...] );
    \end{lstlisting}

    \item if no condition is specified, all tuples will be updated
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tuple Update Example}

  \begin{itemize}
    \item register a new vote (9) for the movie "Suspiria"
    \begin{lstlisting}
UPDATE MOVIE
  WHERE (TITLE = "Suspiria") (
    SCORE := SCORE(
      (THE_VALUE(SCORE)
         * CAST_AS_RATIONAL(VOTES)
         + CAST_AS_RATIONAL(9))
       / CAST_AS_RATIONAL(VOTES + 1)
    ),
    VOTES := VOTES + 1
  );
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Foreign Key Definition}

  \begin{itemize}
    \item defining a foreign key
    \begin{lstlisting}
CONSTRAINT constraint_name
  referencing_relvar_name
      { attribute_name }
    <= referenced_relvar_name
        { attribute_name };
    \end{lstlisting}

    \item attribute names have to match (rename if necessary)
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Foreign Key Example}

  \begin{lstlisting}
CONSTRAINT CASTING_FKEY_MOVIE
  CASTING { MOVIE# }
    <= MOVIE { MOVIE# };
  \end{lstlisting}

  \pause
  \begin{lstlisting}
CONSTRAINT MOVIE_FKEY_DIRECTOR
    MOVIE { DIRECTOR# }
        RENAME (DIRECTOR# AS PERSON#)
      <= PERSON { PERSON# };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{lstlisting}
TYPE MOVIE# POSSREP { VALUE INTEGER };

TYPE YEAR POSSREP { VALUE INTEGER };

TYPE SCORE POSSREP { VALUE RATIONAL
  CONSTRAINT (VALUE >= 1.0)
         AND (VALUE <= 10.0) };

TYPE PERSON# POSSREP { VALUE INTEGER };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{lstlisting}
VAR MOVIE BASE RELATION
  { MOVIE# MOVIE#, TITLE CHAR, YEAR YEAR,
    SCORE SCORE, VOTES INTEGER,
    DIRECTOR# PERSON# }
  KEY { MOVIE# };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{lstlisting}
VAR PERSON BASE RELATION
    { PERSON# PERSON#, NAME CHAR }
    KEY { PERSON# };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{lstlisting}
VAR CASTING BASE RELATION
    { MOVIE# MOVIE#, ACTOR# PERSON#,
      ORD INTEGER }
    KEY { MOVIE#, ACTOR# };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{lstlisting}
CONSTRAINT MOVIE_FKEY_DIRECTOR
  MOVIE { DIRECTOR# }
      RENAME (DIRECTOR# AS PERSON#)
    <= PERSON { PERSON# };
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{lstlisting}
CONSTRAINT CASTING_FKEY_MOVIE
  CASTING { MOVIE# } <= MOVIE { MOVIE# };

CONSTRAINT CASTING_FKEY_ACTOR
  CASTING { ACTOR# }
      RENAME (ACTOR# AS PERSON#)
    <= PERSON { PERSON# };
  \end{lstlisting}
\end{frame}

% \lstset{language=FullSQL}

\section{SQL}

\subsection{Data Types}

\begin{frame}
  \frametitle{Data Types}

  \begin{itemize}
    \item \texttt{INTEGER}
    \begin{itemize}
      \item \texttt{SMALLINT}
    \end{itemize}

    \medskip
    \item \texttt{NUMERIC (precision, scale)}
    \begin{itemize}
      \item \texttt{precision}: total number of digits
      \item \texttt{scale}: number of digits after the decimal point
      \item same as: \texttt{DECIMAL (precision, scale)}
    \end{itemize}

    \medskip
    \item \texttt{FLOAT (p)}
    \begin{itemize}
      \item \texttt{p}: lowest acceptable precision
    \end{itemize}

    \medskip
    \item \texttt{BOOLEAN}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{String Data Types}

  \begin{itemize}
    \item \texttt{CHARACTER [ VARYING ] (n)}
    \begin{itemize}
      \item in \texttt{CHARACTER (n)}, if the string is shorter than
        \texttt{n} characters\\
        it will be padded with spaces
    \end{itemize}

    \item abbreviations:
    \begin{itemize}
      \item \texttt{CHAR (n)} instead of \texttt{CHARACTER (n)}
      \item \texttt{VARCHAR (n)} instead of \texttt{CHARACTER VARYING (n)}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Date / Time Data Types}

  \begin{itemize}
    \item \texttt{DATE}
    \begin{itemize}
      \item value example: \texttt{2005-09-26}
    \end{itemize}

    \medskip
    \item \texttt{TIME}
    \begin{itemize}
      \item value example: \texttt{11:59:22.078717}
    \end{itemize}

    \medskip
    \item \texttt{TIMESTAMP}
    \begin{itemize}
      \item value example: \texttt{2005-09-26 11:59:22.078717}
    \end{itemize}

    \medskip
    \item \texttt{INTERVAL}
    \begin{itemize}
      \item value example: \texttt{3 days}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Large Object Data Types}

  \begin{itemize}
    \item arbitrary length objects
    \item can not be used in queries

    \bigskip
    \item text: \texttt{CHARACTER LARGE OBJECT (n)}
    \begin{itemize}
      \item \texttt{CLOB}
    \end{itemize}

    \item binary: \texttt{BINARY LARGE OBJECT (n)}
    \begin{itemize}
      \item \texttt{BLOB}
      \item picture, audio, etc.
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Domain Creation}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE DOMAIN domain_name [ AS ] base_type
  [ DEFAULT default_value ]
  [ { CHECK ( condition ) } [, ...] ]
    \end{lstlisting}
  \end{block}

  \medskip
  \begin{itemize}
    \item deleting domains:
    \begin{lstlisting}
DROP DOMAIN domain_name [, ...]
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Domain Example}

  \begin{example}[a domain for valid \texttt{SCORE} values]
    \begin{lstlisting}
CREATE DOMAIN SCORES AS FLOAT
  CHECK ((VALUE >= 1.0) AND (VALUE <= 10.0))
    \end{lstlisting}
  \end{example}
\end{frame}

\subsection{Table Management}

\begin{frame}[fragile]
  \frametitle{Table Creation}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE TABLE table_name (
  { column_name data_type }
  [, ... ]
)
    \end{lstlisting}
  \end{block}

  \medskip
  \begin{itemize}
    \item deleting tables:
    \begin{lstlisting}
DROP TABLE table_name [, ... ]
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Null and Default Values}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE TABLE table_name (
  { column_name data_type
              [ NULL | NOT NULL ]
              [ DEFAULT default_value ] }
  [, ... ]
)
    \end{lstlisting}
  \end{block}

  \begin{itemize}
    \item \texttt{NULL}: the attribute is allowed to be empty (default)
    \item \texttt{NOT NULL}: the attribute is not allowed to be empty
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Primary Key Definition}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE TABLE table_name (
  { column_name data_type
              [ NULL | NOT NULL ]
              [ DEFAULT default_value ] }
  [, ... ]
  [ PRIMARY KEY ( column_name [, ...] ) ]
)
    \end{lstlisting}
  \end{block}

  \begin{itemize}
    \item if the primary key consists of a single column,\\
      it can be specified in column definition:
      \begin{lstlisting}
column_name data_type PRIMARY KEY
      \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Table Creation Example}

  \begin{example}
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER,
  TITLE VARCHAR(80) NOT NULL,
  YR NUMERIC(4),
  DIRECTOR VARCHAR(40),
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  PRIMARY KEY (ID)
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Table Creation Example}

  \begin{example}
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  ...
  VOTES INTEGER DEFAULT 0
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Automatically Incremented Values}

  \begin{itemize}
    \item product-specific definitions

    \bigskip
    \item PostgreSQL: \texttt{SERIAL} data type:\\
      \lstinline!ID SERIAL PRIMARY KEY!

    \smallskip
    \item MySQL: \texttt{AUTO\_INCREMENT} property\\
      \lstinline!ID INTEGER PRIMARY KEY AUTO_INCREMENT!
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Value Constraints}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE TABLE table_name (
  ...
  [ { CHECK ( condition ) }
    [, ...] ]
  ...
)
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Value Constraint Example}

  \begin{example}
    \begin{itemize}
      \item \texttt{SCORE} values must be between \texttt{1.0} and \texttt{10.0}
    \end{itemize}

    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  ...,
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  CHECK ((SCORE >= 1.0) AND (SCORE <= 10.0))
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Uniqueness Definition}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE TABLE table_name (
  ...
  [ { UNIQUE ( column_name [, ...] ) }
    [, ...] ]
  ...
)
    \end{lstlisting}
  \end{block}

  \begin{itemize}
    \item if the uniqueness constraint consists of a single column,\\
      it can be specified in the column definition:
      \begin{lstlisting}
column_name data_type UNIQUE
      \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Uniqueness Definition Example}

  \begin{example}
    \begin{itemize}
      \item \texttt{\{TITLE\}} and \texttt{\{DIRECTOR, YR\}} are unique
    \end{itemize}

    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  TITLE VARCHAR(80) UNIQUE NOT NULL,
  YR NUMERIC(4),
  DIRECTOR VARCHAR(40),
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  UNIQUE (DIRECTOR, YR)
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Renaming Tables}

  \begin{block}{Syntax}
    \begin{lstlisting}
ALTER TABLE table_name
  RENAME TO new_name
    \end{lstlisting}
  \end{block}

  \medskip
  \begin{example}
    \begin{lstlisting}
ALTER TABLE MOVIE
  RENAME TO FILM
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Adding Columns}

  \begin{block}{Syntax}
    \begin{lstlisting}
ALTER TABLE table_name
  ADD [ COLUMN ] column_name data_type
                 [ NULL | NOT NULL ]
                 [ DEFAULT default_value ]
    \end{lstlisting}
  \end{block}

  \medskip
  \begin{example}
    \begin{lstlisting}
ALTER TABLE MOVIE
  ADD COLUMN RUNTIME INTEGER
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Deleting Columns}

  \begin{block}{Syntax}
    \begin{lstlisting}
ALTER TABLE table_name
  DROP [ COLUMN ] column_name
    \end{lstlisting}
  \end{block}

  \medskip
  \begin{example}
    \begin{lstlisting}
ALTER TABLE MOVIE
  DROP COLUMN RUNTIME
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Renaming Columns}

  \begin{block}{Syntax}
    \begin{lstlisting}
ALTER TABLE table_name
  RENAME [ COLUMN ] column_name TO new_name
    \end{lstlisting}
  \end{block}

  \medskip
  \begin{example}
    \begin{lstlisting}
ALTER TABLE MOVIE
  RENAME COLUMN TITLE TO NAME
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Column Default Value}

  \begin{block}{Setting Column Default Value}
    \begin{lstlisting}
ALTER TABLE table_name
  ALTER [ COLUMN ] column_name
  SET DEFAULT default_value
    \end{lstlisting}
  \end{block}

  \begin{block}{Removing Column Default Value}
    \begin{lstlisting}
ALTER TABLE table_name
  ALTER [ COLUMN ] column_name
  DROP DEFAULT
    \end{lstlisting}
  \end{block}
  \medskip
\end{frame}

\begin{frame}[fragile]
  \frametitle{Adding Constraints}

  \begin{block}{Syntax}
    \begin{lstlisting}
ALTER TABLE table_name
  ADD [ CONSTRAINT constraint_name ]
    constraint_definition
    \end{lstlisting}
  \end{block}
  \begin{itemize}
   \item removing constraints:
    \begin{lstlisting}
ALTER TABLE table_name
  DROP [ CONSTRAINT ] constraint_name
    \end{lstlisting}

    \pause
    \item when adding constraints, what happens with existing tuples?
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Constraint Addition Example}

  \begin{example}
    \begin{itemize}
      \item \texttt{YR} values can not be less than 1888
    \end{itemize}

    \begin{lstlisting}
ALTER TABLE MOVIE
  ADD CONSTRAINT MINIMUM_YEAR
    CHECK (YR >= 1888)
    \end{lstlisting}

    \begin{itemize}
      \item drop the minimum year constraint
    \end{itemize}

    \begin{lstlisting}
ALTER TABLE MOVIE
  DROP CONSTRAINT MINIMUM_YEAR
    \end{lstlisting}
  \end{example}
\end{frame}

\subsection{Data Modification}

\begin{frame}[fragile]
  \frametitle{Row Insertion}

  \begin{block}{Syntax}
    \begin{lstlisting}
INSERT INTO table_name
  [ ( column_name [, ...] ) ]
  VALUES ( column_value [, ...] )
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item the order of values must match the order of columns
    \item if the column names are not specified,\\
      values must be written in the order used at table creation
    \item unspecified attributes will take their default values
    \item automatically generated columns should not be specified
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Row Insertion Example}

  \begin{example}
    \begin{lstlisting}
INSERT INTO MOVIE VALUES (
  6,
  'Usual Suspects',
  1995,
  'Bryan Singer',
  8.7,
  35027
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Row Insertion Example}

  \begin{example}
    \begin{lstlisting}
INSERT INTO MOVIE (YR, TITLE) VALUES (
  1995,
  'Usual Suspects'
)
    \end{lstlisting}

    \begin{itemize}
      \item the \texttt{ID} value will be automatically generated
    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Row Deletion}

  \begin{block}{Syntax}
    \begin{lstlisting}
DELETE FROM table_name
  [ WHERE condition ]
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Row Deletion Example}

  \begin{example}
    \begin{itemize}
      \item delete movies with scores less than 3.0 and votes more than 4
    \end{itemize}

    \begin{lstlisting}
DELETE FROM MOVIE
  WHERE ((SCORE < 3.0) AND (VOTES > 4))
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Row Update}

  \begin{block}{Syntax}
    \begin{lstlisting}
UPDATE table_name
  SET { column_name = column_value } [, ...]
  [ WHERE condition ]
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Row Update Example}

  \begin{example}
    \begin{itemize}
      \item register a new vote (9) for the movie "Suspiria"
    \end{itemize}

    \begin{lstlisting}
UPDATE MOVIE
  SET SCORE = (SCORE * VOTES + 9)
                  / (VOTES + 1),
      VOTES = VOTES + 1
  WHERE (TITLE = 'Suspiria')
    \end{lstlisting}
  \end{example}
\end{frame}

\subsection{Referential Integrity}

\begin{frame}[fragile]
  \frametitle{Foreign Key Definition}

  \begin{block}{Syntax}
    \begin{lstlisting}
CREATE TABLE table_name (
  ...
  [ { FOREIGN KEY ( column_name [, ...] )
        REFERENCES table_name
          [ ( column_name [, ...] ) ]
        [ ON DELETE option ]
        [ ON UPDATE option ] } [, ...] ]
  ...
)
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Referential Integrity Options}

  \begin{itemize}
    \item what to do if referential integrity will be broken?

    \medskip
    \item don't allow: \texttt{RESTRICT}, \texttt{NO\_ACTION}
    \item reflect the change to affected tuples: \texttt{CASCADE}
    \item assign null value: \texttt{SET NULL}
    \item assign default value: \texttt{SET DEFAULT}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Referential Integrity Examples}

  \begin{example}[restrict when deleting]
    \begin{itemize}
      \item if the \texttt{ID} attribute of the director to be deleted\\
        from the \texttt{PERSON} relation is present among the current values\\
        of the \texttt{DIRECTORID} attribute of the \texttt{MOVIE} relation,\\
        do not allow deleting
    \end{itemize}
  \end{example}

  \pause
  \begin{example}[cascade when updating]
    \begin{itemize}
      \item when the \texttt{ID} attribute value of a director has been
        updated\\
        in the \texttt{PERSON} relation, also update the \texttt{DIRECTORID}
        attribute\\
        of the corresponding tuples in the \texttt{MOVIE} relation
    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Referential Integrity Example}

  \begin{example}[cascade when deleting]
    \begin{itemize}
      \item delete a person from the \texttt{PERSON} relation

      \pause
      \item delete all tuples from the \texttt{CASTING} relation\\
        where the \texttt{ACTORID} attribute has the same value\\
        as the \texttt{ID} attribute of the deleted person

      \pause
      \item delete all tuples from the \texttt{MOVIE} relation\\
        where the \texttt{DIRECTORID} attribute has the same value\\
        as the \texttt{ID} attribute of the deleted person

      \pause
      \item for each deleted \texttt{MOVIE} tuple in the previous step,\\
        delete all tuples from the \texttt{CASTING} relation\\
        where the \texttt{MOVIEID} attribute has the same value\\
        as the \texttt{ID} attribute of the deleted movie

    \end{itemize}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Foreign Key Definition Example}

  \begin{example}[\texttt{MOVIE.DIRECTORID}]
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  ...
  DIRECTORID INTEGER,
  FOREIGN KEY DIRECTORID
    REFERENCES PERSON (ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Foreign Key Definition}

  \begin{itemize}
    \item if the foreign key corresponds to the primary key\\
      in the referenced table, it does not have to be specified\\
      in the \texttt{REFERENCES} part

    \medskip
    \item if the foreign key consists of only one column,\\
      it can be specified in the column definition:
    \begin{lstlisting}
column_name data_type
  REFERENCES table_name [ ( column_name ) ]
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{example}[\texttt{MOVIE}]
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  TITLE VARCHAR(80) NOT NULL,
  YR NUMERIC(4),
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  DIRECTORID INTEGER REFERENCES PERSON
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{example}[\texttt{PERSON}]
    \begin{lstlisting}
CREATE TABLE PERSON (
  ID INTEGER PRIMARY KEY,
  NAME VARCHAR(40) UNIQUE NOT NULL
)
    \end{lstlisting}
  \end{example}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Database}

  \begin{example}[\texttt{CASTING}]
    \begin{lstlisting}
CREATE TABLE CASTING (
  MOVIEID INTEGER REFERENCES MOVIE,
  ACTORID INTEGER REFERENCES PERSON,
  ORD INTEGER,
  PRIMARY KEY (MOVIEID, ACTORID)
)
    \end{lstlisting}
  \end{example}
\end{frame}

\section*{References}

\begin{frame}
  \frametitle{References}

  \begin{block}{Required Reading: Date}
    \begin{itemize}
      \item Chapter 3: An Introduction to Relational Databases
      \begin{itemize}
        \item 3.2. \alert{An Informal Look at the Relational Model}
        \item 3.3. \alert{Relations and Relvars}
      \end{itemize}

      \item Chapter 6: \alert{Relations}

      \item Chapter 9: Integrity
      \begin{itemize}
        \item 9.10. \alert{Keys}
        \item 9.12. \alert{SQL Facilities}
      \end{itemize}
    \end{itemize}
  \end{block}
\end{frame}

\end{document}
