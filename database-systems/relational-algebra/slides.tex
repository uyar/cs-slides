% Copyright (c) 2002-2015
%       H. Turgut Uyar <uyar@itu.edu.tr>
%       Şule Gündüz Öğüdücü <sgunduz@itu.edu.tr>
%
% This work is licensed under a "Creative Commons
% Attribution-NonCommercial-ShareAlike 4.0 International License".
% For more information, please visit:
% https://creativecommons.org/licenses/by-nc-sa/4.0/

\documentclass[dvipsnames]{beamer}

\usepackage{ae}
\usepackage[scaled=0.88]{beramono}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\setbeamersize{text margin left=2em, text margin right=2em}
\usepackage[labelformat=empty, aboveskip=1pt, belowskip=1pt]{caption}

\usepackage{listings}
\lstdefinelanguage{TutorialD}[]{}{
  morekeywords={AND, AS, BASE, BOOL, CAST_AS_, CAST_AS_RATIONAL, CHAR,
                CONSTRAINT, DELETE, DIVIDEBY, DROP, INSERT, INTEGER, INTERSECT,
                JOIN, KEY, MINUS, OR, PER, POSSREP, RATIONAL, RELATION, RENAME,
                THE_, TUPLE, TYPE, UNION, UPDATE, VAR, WHERE}
}
\lstdefinelanguage{FullSQL}[]{SQL}{
  morekeywords={BINARY, BOOLEAN, CYCLE, FINAL, INCREMENT, IS, LARGE, MAXVALUE,
                MINVALUE, NO_ACTION, OBJECT, REFERENCES, RENAME, SEQUENCE,
                START, TO, TYPE, VACUUM}
}
\lstset{basicstyle=\ttfamily, keywordstyle=\color{ForestGreen},
        showstringspaces=false}

\mode<presentation>
{
  \usetheme{Warsaw}
  \usecolortheme[named=ForestGreen]{structure}
  \setbeamercovered{transparent}
}

\title{Database Systems}
\subtitle{Relational Algebra}

\author{H. Turgut Uyar \and Şule Öğüdücü}
\date{2002-2015}

\AtBeginSubsection[]{
  \begin{frame}<beamer>
    \frametitle{Topics}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}

\theoremstyle{plain}

\pgfdeclareimage[width=2cm]{license}{../license}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{License}

  \pgfuseimage{license}\hfill
  \copyright~2002-2015 T. Uyar, Ş. Öğüdücü

  \vfill
  \begin{footnotesize}
    You are free to:
    \begin{itemize}
      \itemsep0em
      \item Share -- copy and redistribute the material in any medium or format
      \item Adapt -- remix, transform, and build upon the material
    \end{itemize}

    Under the following terms:
    \begin{itemize}
      \itemsep0em
      \item Attribution -- You must give appropriate credit, provide a link to
        the license, and indicate if changes were made.

      \item NonCommercial -- You may not use the material for commercial
        purposes.

      \item ShareAlike -- If you remix, transform, or build upon the material,
        you must distribute your contributions under the same license as the
        original.
    \end{itemize}
  \end{footnotesize}

  \begin{small}
    For more information:\\
    \url{https://creativecommons.org/licenses/by-nc-sa/4.0/}

    \smallskip
    Read the full license:\\
    \url{https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode}
  \end{small}
\end{frame}

\begin{frame}
  \frametitle{Topics}
  \tableofcontents
\end{frame}

\lstset{language=TutorialD}

\section{Relational Algebra}

\subsection{Introduction}

\begin{frame}
  \frametitle{Closure}

  \begin{itemize}
    \item \alert{closure}: input and output of all operations are relations

    \medskip
    \item output of one operation can be the input to another
    \item operations can be nested
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Example Database}

  \begin{tiny}
  \begin{table}
    \caption{MOVIE}
    \begin{tabular}{|r|l|r|r|r|r|}\hline
\underline{MOVIE\#} & TITLE           & YEAR & SCORE & VOTES & DIRECTOR\#\\[2pt]\hline\hline
   6 & The Usual Suspects             & 1995 &   8.7 & 35027 &        639\\\hline
  70 & Being John Malkovich           & 1999 &   8.3 & 13809 &       1485\\\hline
 107 & Batman \& Robin                & 1997 &   3.5 & 10577 &        105\\\hline
 110 & Sleepy Hollow                  & 1999 &   7.5 & 10514 &        148\\\hline
 112 & Three Kings                    & 1999 &   7.7 & 10319 &       1070\\\hline
 151 & Gattaca                        & 1997 &   7.4 &  8388 &       2020\\\hline
 213 & Blade                          & 1998 &   6.7 &  6885 &       2861\\\hline
 228 & Ed Wood                        & 1994 &   7.8 &  6587 &        148\\\hline
 251 & End of Days                    & 1999 &   5.5 &  6095 &        103\\\hline
 281 & Dangerous Liaisons             & 1988 &   7.7 &  5651 &        292\\\hline
 373 & Fear and Loathing in Las Vegas & 1998 &   6.5 &  4658 &         59\\\hline
 432 & Stigmata                       & 1999 &   6.1 &  4141 &       2557\\\hline
 433 & eXistenZ                       & 1999 &   6.9 &  4130 &         97\\\hline
 573 & Dead Man                       & 1995 &   7.4 &  3333 &        175\\\hline
1468 & Europa                         & 1991 &   7.6 &  1042 &        615\\\hline
1512 & Suspiria                       & 1977 &   7.1 &  1004 &       2259\\\hline
1539 & Cry-Baby                       & 1990 &   5.9 &   972 &        364\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}
  \frametitle{Example Database}

  \begin{columns}[b]
    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{PERSON}
      \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
   9 & Arnold Schwarzenegger\\\hline
  26 & Johnny Depp          \\\hline
  59 & Terry Gilliam        \\\hline
  97 & David Cronenberg     \\\hline
 103 & Peter Hyams          \\\hline
 105 & Joel Schumacher      \\\hline
 138 & George Clooney       \\\hline
 148 & Tim Burton           \\\hline
 175 & Jim Jarmusch         \\\hline
 187 & Christina Ricci      \\\hline
 243 & Uma Thurman          \\\hline
 282 & Cameron Diaz         \\\hline
 292 & Stephen Frears       \\\hline
 302 & Benicio Del Toro     \\\hline
 308 & Gabriel Byrne        \\\hline
 350 & Jennifer Jason Leigh \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|r|l|}\hline
 364 & John Waters          \\\hline
 406 & Patricia Arquette    \\\hline
 503 & John Malkovich       \\\hline
 615 & Lars von Trier       \\\hline
 639 & Bryan Singer         \\\hline
 745 & Udo Kier             \\\hline
 793 & Jude Law             \\\hline
1070 & David O. Russell     \\\hline
1485 & Spike Jonze          \\\hline
1641 & Iggy Pop             \\\hline
2020 & Andrew Niccol        \\\hline
2259 & Dario Argento        \\\hline
2557 & Rupert Wainwright    \\\hline
2861 & Stephen Norrington   \\\hline
3578 & Traci Lords          \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Example Database}

  \begin{columns}[b]
    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{CASTING}
      \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
      6 &     308 &   2\\\hline
      6 &     302 &   3\\\hline
     70 &     282 &   2\\\hline
     70 &     503 &  14\\\hline
    107 &       9 &   1\\\hline
    107 &     138 &   2\\\hline
    107 &     243 &   4\\\hline
    110 &      26 &   1\\\hline
    110 &     187 &   2\\\hline
    112 &     138 &   1\\\hline
    112 &    1485 &   4\\\hline
    151 &     243 &   2\\\hline
    151 &     793 &   3\\\hline
    213 &     745 &   6\\\hline
    213 &    3578 &   8\\\hline
    228 &      26 &   1\\\hline
    228 &     406 &   4\\\hline
    251 &       9 &   1\\\hline
    251 &     308 &   2\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|r|r|r|}\hline
    251 &     745 &  10\\\hline
    281 &     243 &   7\\\hline
    281 &     503 &   2\\\hline
    373 &      26 &   1\\\hline
    373 &     187 &   6\\\hline
    373 &     282 &   8\\\hline
    373 &     302 &   2\\\hline
    432 &     308 &   2\\\hline
    432 &     406 &   1\\\hline
    433 &     350 &   1\\\hline
    433 &     793 &   2\\\hline
    573 &      26 &   1\\\hline
    573 &     308 &  12\\\hline
    573 &    1641 &   6\\\hline
   1468 &     745 &   3\\\hline
   1512 &     745 &   9\\\hline
   1539 &      26 &   1\\\hline
   1539 &    1641 &   5\\\hline
   1539 &    3578 &   7\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\subsection{Selection}

\begin{frame}[fragile]
  \frametitle{Selection}

  \begin{itemize}
    \item \alert{selection}: selecting tuples that satisfy a condition
    \begin{lstlisting}
relation WHERE condition
    \end{lstlisting}

    \medskip
    \item output header = input header
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Selection Examples - 1}

  \begin{itemize}
    \item movies with more than 10000 votes (\texttt{S1})
    \begin{lstlisting}
MOVIE WHERE (VOTES > 10000)
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{S1}
    \begin{tabular}{|r|l|r|r|r|r|}\hline
\underline{MOVIE\#} & TITLE & YEAR & SCORE & VOTES & DIRECTOR\#\\[2pt]\hline\hline
  6 & The Usual Suspects    & 1995 &   8.7 & 35027 &        639\\\hline
 70 & Being John Malkovich  & 1999 &   8.3 & 13809 &       1485\\\hline
107 & Batman \& Robin       & 1997 &   3.5 & 10577 &        105\\\hline
110 & Sleepy Hollow         & 1999 &   7.5 & 10514 &        148\\\hline
112 & Three Kings           & 1999 &   7.7 & 10319 &       1070\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Selection Examples - 2}

  \begin{itemize}
    \item movies older than 1992, with scores higher than 7.5
      (\texttt{S2})
    \begin{lstlisting}
MOVIE WHERE ((YEAR < YEAR(1992))
         AND (SCORE > SCORE(7.5)))
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{S2}
    \begin{tabular}{|r|l|r|r|r|r|}\hline
\underline{MOVIE\#} & TITLE & YEAR & SCORE & VOTES & DIRECTOR\#\\[2pt]\hline\hline
   281 & Dangerous Liaisons & 1988 &   7.7 &  5651 &        292\\\hline
  1468 & Europa             & 1991 &   7.6 &  1042 &        615\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection}

  \begin{itemize}
    \item \alert{projection}: selecting a set of attributes
    \begin{lstlisting}
relation { attribute_name [, ...] }
    \end{lstlisting}

    \medskip
    \item output header = attribute list
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection Examples - 1}

  \begin{itemize}
      \item titles of all movies (\texttt{P1})
    \begin{lstlisting}
MOVIE { TITLE }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{columns}[b]
    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{P1}
      \begin{tabular}{|l|}\hline
\underline{TITLE}             \\[2pt]\hline\hline
The Usual Suspects            \\\hline
Being John Malkovich          \\\hline
Batman \& Robin               \\\hline
Sleepy Hollow                 \\\hline
Three Kings                   \\\hline
Gattaca                       \\\hline
Blade                         \\\hline
Ed Wood                       \\\hline
End of Days                   \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|l|}\hline
Dangerous Liaisons            \\\hline
Fear and Loathing in Las Vegas\\\hline
Stigmata                      \\\hline
eXistenZ                      \\\hline
Dead Man                      \\\hline
Europa                        \\\hline
Suspiria                      \\\hline
Cry-Baby                      \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection Examples - 2}

  \begin{itemize}
    \item titles and years of all movies (\texttt{P2})
    \begin{lstlisting}
MOVIE { TITLE, YEAR }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{columns}[b]
    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{P2}
      \begin{tabular}{|l|r|}\hline
\underline{TITLE}              & \underline{YEAR}\\[2pt]\hline\hline
Batman \& Robin                & 1997\\\hline
Being John Malkovich           & 1999\\\hline
Blade                          & 1998\\\hline
Cry-Baby                       & 1990\\\hline
Dangerous Liaisons             & 1988\\\hline
Dead Man                       & 1995\\\hline
Ed Wood                        & 1994\\\hline
End of Days                    & 1999\\\hline
Europa                         & 1991\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|l|r|}\hline
Fear and Loathing in Las Vegas & 1998\\\hline
Gattaca                        & 1997\\\hline
Sleepy Hollow                  & 1999\\\hline
Stigmata                       & 1999\\\hline
Suspiria                       & 1977\\\hline
Three Kings                    & 1999\\\hline
The Usual Suspects             & 1995\\\hline
eXistenZ                       & 1999\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection Examples - 3}

  \begin{itemize}
    \item years of all movies (\texttt{P3})
    \begin{lstlisting}
MOVIE { YEAR }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{P3}
    \begin{tabular}{|r|}\hline
\underline{YEAR}\\[2pt]\hline\hline
            1995\\\hline
            1999\\\hline
            1997\\\hline
            1998\\\hline
            1994\\\hline
            1988\\\hline
            1991\\\hline
            1977\\\hline
            1990\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}
  \frametitle{Projection Examples - 4}

  \begin{itemize}
    \item titles of movies with votes more than 5000\\
      and scores higher than 7.0 (\texttt{P4})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item movies with votes more than 5000\\
      and scores higher than 7.0 (\texttt{P4A})
    \item titles in \texttt{P4A} (\texttt{P4})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection Examples - 4}

  \begin{itemize}
    \item movies with votes more than 5000\\
      and scores higher than 7.0 (\texttt{P4A})
    \begin{lstlisting}
MOVIE WHERE ((VOTES > 5000)
         AND (SCORE > SCORE(7.0)))
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{P4A}
    \begin{tabular}{|r|l|r|r|r|r|}\hline
\underline{MOVIE\#} & TITLE & YEAR & SCORE & VOTES & DIRECTOR\#\\[2pt]\hline\hline
   6 & The Usual Suspects   & 1995 &   8.7 & 35027 &        639\\\hline
  70 & Being John Malkovich & 1999 &   8.3 & 13809 &       1485\\\hline
 110 & Sleepy Hollow        & 1999 &   7.5 & 10514 &        148\\\hline
 112 & Three Kings          & 1999 &   7.7 & 10319 &       1070\\\hline
 151 & Gattaca              & 1997 &   7.4 &  8388 &       2020\\\hline
 228 & Ed Wood              & 1994 &   7.8 &  6587 &        148\\\hline
 281 & Dangerous Liaisons   & 1988 &   7.7 &  5651 &        292\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection Examples - 4}

  \begin{itemize}
    \item titles in \texttt{P4A} (\texttt{P4})
    \begin{lstlisting}
P4A { TITLE }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{P4}
    \begin{tabular}{|l|}\hline
\underline{TITLE}   \\[2pt]\hline\hline
Being John Malkovich\\\hline
Dangerous Liaisons  \\\hline
Ed Wood             \\\hline
Gattaca             \\\hline
Sleepy Hollow       \\\hline
Three Kings         \\\hline
The Usual Suspects  \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Projection Examples - 4}

  \begin{itemize}
    \item titles of movies with votes more than 5000\\
      and scores higher than 7.0 (\texttt{P4})
    \begin{lstlisting}
( MOVIE
    WHERE ((VOTES > 5000)
       AND (SCORE > SCORE(7.0))) )
  { TITLE }
    \end{lstlisting}
  \end{itemize}
\end{frame}

\subsection{Join}

\begin{frame}[fragile]
  \frametitle{Join}

  \begin{itemize}
    \item \alert{join}: matching tuples of two relations\\
      over common values of one or more attributes
    \begin{lstlisting}
relation1 JOIN relation2
    \end{lstlisting}

    \pause
    \medskip
    \item \alert{natural join}: over common values of all the attributes\\
      with the same name
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Join}

  \begin{itemize}
    \item from the Cartesian product of the two relations,\\
      selecting the tuples which have the same values\\
      for the given attributes
    \item matching attributes are not repeated in the output

    \medskip
    \item output header = relation1 header $\cup$ relation2 header
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Join Examples - 1}

  \begin{itemize}
    \item titles and director names of all movies
      (\texttt{J1})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item all movies and their directors (\texttt{J1A})
    \item titles and director names in \texttt{J1A} (\texttt{J1})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 1}

  \begin{itemize}
    \item all movies and their directors (\texttt{J1A})
    \begin{lstlisting}
MOVIE JOIN
  (PERSON RENAME { PERSON# AS DIRECTOR# })
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J1A}
    \begin{tabular}{|r|l|c|r|l|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\# & NAME            \\[2pt]\hline\hline
   6 & The Usual Suspects   & ... &       639  & Bryan Singer    \\\hline
  70 & Being John Malkovich & ... &      1485  & Spike Jonze     \\\hline
 107 & Batman \& Robin      & ... &       105  & Joel Schumacher \\\hline
 ... & ...                  & ... &       ...  & ...             \\\hline
1468 & Europa               & ... &       615  & Lars von Trier  \\\hline
1512 & Suspiria             & ... &      2259  & Dario Argento   \\\hline
1539 & Cry-Baby             & ... &       364  & John Waters     \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 1}

  \begin{itemize}
    \item titles and director names in \texttt{J1A}
      (\texttt{J1})
    \begin{lstlisting}
J1A { TITLE, NAME }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J1}
    \begin{tabular}{|l|l|}\hline
\underline{TITLE}    & \underline{NAME}\\[2pt]\hline\hline
Batman \& Robin      & Joel Schumacher \\\hline
Being John Malkovich & Spike Jonze     \\\hline
Blade                & Stephen Norrington\\\hline
...                  & ...             \\\hline
Three Kings          & Spike Jonze     \\\hline
The Usual Suspects   & Bryan Singer    \\\hline
eXistenZ             & David Cronenberg\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}
  \frametitle{Join Examples - 2}

  \begin{itemize}
    \item titles, actor names and actor orders of all movies (\texttt{J2})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item all movies and their casting data (\texttt{J2A})
    \item all data in \texttt{J2A} matched with persons (\texttt{J2B})
    \item titles, actor names and actor orders in \texttt{J2B} (\texttt{J2})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 2}

  \begin{itemize}
    \item all movies and their casting data (\texttt{J2A})
    \begin{lstlisting}
MOVIE JOIN CASTING
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J2A}
    \begin{tabular}{|r|l|c|r|r|}\hline
\underline{MOVIE\#} & TITLE & ... & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
   6 & The Usual Suspects   & ... &                 302 &   3\\\hline
   6 & The Usual Suspects   & ... &                 308 &   2\\\hline
  70 & Being John Malkovich & ... &                 282 &   2\\\hline
  70 & Being John Malkovich & ... &                 503 &  14\\\hline
 ... & ...                  & ... &                 ... & ...\\\hline
1539 & Cry-Baby             & ... &                  26 &   1\\\hline
1539 & Cry-Baby             & ... &                1641 &   5\\\hline
1539 & Cry-Baby             & ... &                3578 &   7\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 2}

  \begin{itemize}
    \item all data in \texttt{J2A} matched with persons (\texttt{J2B})
    \begin{lstlisting}
J2A JOIN
  (PERSON RENAME { PERSON# AS ACTOR# })
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J2B}
    \begin{tabular}{|r|l|c|r|r|l|}\hline
\underline{MOVIE\#} & TITLE & ... & \underline{ACTOR\#} & ORD & NAME\\[2pt]\hline\hline
   6 & The Usual Suspects   & ... &     302 &   3 & Benicio Del Toro\\\hline
   6 & The Usual Suspects   & ... &     308 &   2 & Gabriel Byrne   \\\hline
  70 & Being John Malkovich & ... &     282 &   2 & Cameron Diaz    \\\hline
  70 & Being John Malkovich & ... &     503 &  14 & John Malkovich  \\\hline
 ... & ...                  & ... &     ... & ... & ...             \\\hline
1539 & Cry-Baby             & ... &      26 &   1 & Johnny Depp     \\\hline
1539 & Cry-Baby             & ... &    1641 &   5 & Iggy Pop        \\\hline
1539 & Cry-Baby             & ... &    3578 &   7 & Traci Lords     \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 2}

  \begin{itemize}
    \item titles, actor names and actor orders in \texttt{J2B}
      (\texttt{J2})
    \begin{lstlisting}
J2B { TITLE, NAME, ORD }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J2}
    \begin{tabular}{|l|l|r|}\hline
\underline{TITLE}    & \underline{NAME} & \underline{ORD}\\[2pt]\hline\hline
The Usual Suspects   & Benicio Del Toro &   3\\\hline
The Usual Suspects   & Gabriel Byrne    &   2\\\hline
Being John Malkovich & Cameron Diaz     &   2\\\hline
Being John Malkovich & John Malkovich   &  14\\\hline
...                  & ...              & ...\\\hline
Cry-Baby             & Johnny Depp      &   1\\\hline
Cry-Baby             & Iggy Pop         &   5\\\hline
Cry-Baby             & Traci Lords      &   7\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}
  \frametitle{Join Examples - 3}

  \begin{itemize}
    \item names of the actors in Johnny Depp's movies (\texttt{J3})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item ids of Johnny Depp's movies (\texttt{J3A})
    \item ids of the actors in the movies in \texttt{J3A} (\texttt{J3B})
    \item names of the actors in \texttt{J3B} (\texttt{J3})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 3}

  \begin{itemize}
    \item ids of Johnny Depp's movies (\texttt{J3A})
    \begin{lstlisting}
(((PERSON RENAME { PERSON# AS ACTOR# })
    JOIN CASTING)
  WHERE (NAME = "Johnny Depp")) { MOVIE# }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J3A}
    \begin{tabular}{|r|l|r|r|}\hline
\underline{MOVIE\#}\\[2pt]\hline\hline
                110\\\hline
                228\\\hline
                373\\\hline
                573\\\hline
               1539\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 3}

  \begin{itemize}
    \item ids of the actors in the movies in \texttt{J3A}
      (\texttt{J3B})
    \begin{lstlisting}
(J3A JOIN CASTING) { ACTOR# }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J3B}
    \begin{tabular}{|r|}\hline
\underline{ACTOR\#}\\[2pt]\hline\hline
                 26\\\hline
                187\\\hline
                282\\\hline
                302\\\hline
                308\\\hline
                406\\\hline
               1641\\\hline
               3578\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Examples - 3}

  \begin{itemize}
    \item names of the actors in \texttt{J3B} (\texttt{J3})
    \begin{lstlisting}
((J3B RENAME { ACTOR# AS PERSON# })
    JOIN PERSON) { NAME }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{J3}
    \begin{tabular}{|l|}\hline
\underline{NAME} \\[2pt]\hline\hline
Johnny Depp      \\\hline
Christina Ricci  \\\hline
Cameron Diaz     \\\hline
Benicio Del Toro \\\hline
Gabriel Byrne    \\\hline
Patricia Arquette\\\hline
Iggy Pop         \\\hline
Traci Lords      \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Division}

  \begin{itemize}
    \item \alert{division}: from the tuples of the first relation,\\
      selecting the ones that match all the tuples\\
      of the second relation in a mediating relation
    \begin{lstlisting}
relation1 DIVIDEBY relation2
  PER (relation3)
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Division Example}

  \begin{itemize}
    \item titles of movies with Johnny Depp and Christina Ricci (\texttt{V1})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item ids of Johnny Depp and Christina Ricci (\texttt{V1A})
    \item ids of movies with all the actors in \texttt{V1A} (\texttt{V1B})
    \item titles of the movies in \texttt{V1B} (\texttt{V1})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Division Example}

  \begin{itemize}
    \item ids of Johnny Depp and Christina Ricci (\texttt{V1A})
    \begin{lstlisting}
(PERSON
    WHERE ((NAME = "Johnny Depp")
        OR (NAME = "Christina Ricci")))
  { PERSON# }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{V1A}
    \begin{tabular}{|r|}\hline
\underline{PERSON\#}\\[2pt]\hline\hline
                26\\\hline
                187\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Division Example}

  \begin{itemize}
    \item ids of movies with all the actors in \texttt{V1A}
      (\texttt{V1B})
    \begin{lstlisting}
(MOVIE { MOVIE# })
    DIVIDEBY
(V1A RENAME { PERSON# AS ACTOR# })
    PER (CASTING { MOVIE#, ACTOR# })
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{V1B}
    \begin{tabular}{|r|}\hline
\underline{MOVIE\#}\\[2pt]\hline\hline
                110\\\hline
                373\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Division Example}

  \begin{itemize}
    \item titles of movies in \texttt{V1B} (\texttt{V1})
    \begin{lstlisting}
(V1B JOIN MOVIE) { TITLE }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{V1}
    \begin{tabular}{|l|}\hline
\underline{TITLE}             \\[2pt]\hline\hline
Fear and Loathing in Las Vegas\\\hline
Sleepy Hollow                 \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Division Example}

  \begin{itemize}
    \item product - division relationship:\\
      \lstinline!V1B JOIN V1A! $\subseteq$
      \lstinline!CASTING { MOVIE#, ACTOR# }!
  \end{itemize}

  \begin{tiny}
  \begin{table}
    \begin{tabular}{|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#}\\[2pt]\hline\hline
                110 &                  26\\\hline
                110 &                 187\\\hline
                373 &                  26\\\hline
                373 &                 187\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\subsection{Set Operations}

\begin{frame}[fragile]
  \frametitle{Intersection}

  \begin{itemize}
    \item \alert{intersection}: selecting the tuples found in both relations
    \begin{lstlisting}
relation1 INTERSECT relation2
    \end{lstlisting}

    \medskip
    \item output header = relation1 header = relation2 header
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Intersection Example}

  \begin{itemize}
    \item names of all directors who also acted (\texttt{I1})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item ids of all directors who also acted (\texttt{I1A})
    \item names of all the persons in \texttt{I1A} (\texttt{I1})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Intersection Example}

  \begin{itemize}
    \item ids of all directors who also acted (\texttt{I1A})
    \begin{lstlisting}
(MOVIE { DIRECTOR# }
      RENAME { DIRECTOR# AS PERSON# })
  INTERSECT
(CASTING { ACTOR# }
      RENAME { ACTOR# AS PERSON# })
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{I1A}
    \begin{tabular}{|r|}\hline
\underline{PERSON\#}\\[2pt]\hline\hline
                1485\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Intersection Example}

  \begin{itemize}
    \item names of all persons in \texttt{I1A} (\texttt{I1})
    \begin{lstlisting}
(I1A JOIN PERSON) { NAME }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{I1}
    \begin{tabular}{|l|}\hline
\underline{NAME}\\[2pt]\hline\hline
Spike Jonze     \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union}

  \begin{itemize}
    \item \alert{union}: selecting the tuples found in at least one of two
      relations
    \begin{lstlisting}
relation1 UNION relation2
    \end{lstlisting}

    \medskip
    \item output header = relation1 header = relation2 header
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Union Example}

  \begin{itemize}
    \item names of all directors and actors of all movies newer than 1997\\
      (\texttt{U1})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item ids and director ids of all movies newer than 1997 (\texttt{U1A})
    \item ids of all actors in the movies in \texttt{U1A} (\texttt{U1B})
    \item ids of directors and actors in at least one of
      \texttt{U1A} and \texttt{U1B} (\texttt{U1C})
    \item names of all the persons in \texttt{U1C} (\texttt{U1})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union Example}

  \begin{itemize}
    \item ids and director ids of all movies newer than 1997 (\texttt{U1A})
    \begin{lstlisting}
(MOVIE WHERE (YEAR > YEAR(1997)))
  { MOVIE#, DIRECTOR# }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{U1A}
    \begin{tabular}{|r|r|}\hline
\underline{MOVIE\#} & DIRECTOR\#\\[2pt]\hline\hline
 70 &       1485\\\hline
110 &        148\\\hline
112 &       1070\\\hline
213 &       2861\\\hline
251 &        103\\\hline
373 &         59\\\hline
432 &       2557\\\hline
433 &         97\\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union Example}

  \begin{itemize}
    \item ids of all actors in the movies in \texttt{U1A}
      (\texttt{U1B})
    \begin{lstlisting}
(U1A JOIN CASTING) { ACTOR# }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{columns}[b]
    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{U1B}
      \begin{tabular}{|r|}\hline
\underline{ACTOR\#}\\[2pt]\hline\hline
                  9\\\hline
                 26\\\hline
                138\\\hline
                187\\\hline
                282\\\hline
                302\\\hline
                308\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.5\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|r|}\hline
                350\\\hline
                406\\\hline
                503\\\hline
                745\\\hline
                793\\\hline
               1485\\\hline
               3578\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union Example}

  \begin{itemize}
    \item ids of directors and actors in at least one of\\
      \texttt{U1A} and \texttt{U1B} (\texttt{U1C})
    \begin{lstlisting}
(U1A { DIRECTOR# }
      RENAME { DIRECTOR# AS PERSON# })
UNION (U1B RENAME { ACTOR# AS PERSON# })
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{columns}[b]
    \column{.3\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{U1C}
      \begin{tabular}{|r|}\hline
\underline{PERSON\#}\\[2pt]\hline\hline
                  9\\\hline
                 26\\\hline
                 59\\\hline
                 97\\\hline
                103\\\hline
                138\\\hline
                148\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.2\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|r|}\hline
                187\\\hline
                282\\\hline
                302\\\hline
                308\\\hline
                350\\\hline
                406\\\hline
                503\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.2\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|r|}\hline
                745\\\hline
                793\\\hline
               1070\\\hline
               1485\\\hline
               2557\\\hline
               2861\\\hline
               3578\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Union Example}

  \begin{itemize}
    \item names of all persons in \texttt{U1C} (\texttt{U1})
    \begin{lstlisting}
(U1C JOIN PERSON) { NAME }
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{columns}[b]
    \column{.3\textwidth}
    \begin{tiny}
    \begin{table}
      \caption{U1}
      \begin{tabular}{|l|}\hline
\underline{NAME}     \\[2pt]\hline\hline
Arnold Schwarzenegger\\\hline
Benicio Del Toro     \\\hline
Cameron Diaz         \\\hline
Christina Ricci      \\\hline
David Cronenberg     \\\hline
David O. Russell     \\\hline
Gabriel Byrne        \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.2\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|l|}\hline
George Clooney       \\\hline
Jennifer Jason Leigh \\\hline
John Malkovich       \\\hline
Johnny Depp          \\\hline
Jude Law             \\\hline
Patricia Arquette    \\\hline
Peter Hyams          \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \column{.2\textwidth}
    \begin{tiny}
    \begin{table}
      \begin{tabular}{|l|}\hline
Rupert Wainwright    \\\hline
Spike Jonze          \\\hline
Stephen Norrington   \\\hline
Terry Gilliam        \\\hline
Tim Burton           \\\hline
Traci Lords          \\\hline
Udo Kier             \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Difference}

  \begin{itemize}
    \item \alert{difference}: selecting the tuples which are found in the first\\
      but not in the second relation
    \begin{lstlisting}
relation1 MINUS relation2
    \end{lstlisting}

    \medskip
    \item output header = relation1 header = relation2 header
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Difference Example}

  \begin{itemize}
    \item names of all actors who haven't played in Johnny Depp's movies
      (\texttt{D1})
  \end{itemize}

  \pause
  \begin{enumerate}
    \item ids of all actors who played in Johnny Depp's movies (\texttt{J3B})
    \item names of all actors who are not in \texttt{J3B} (\texttt{D1})
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Difference Example}

  \begin{itemize}
    \item names of all the actors who are not in \texttt{J3B} (\texttt{D1})
    \begin{lstlisting}
(((CASTING { ACTOR# } MINUS J3B)
      RENAME { ACTOR# AS PERSON# })
  JOIN PERSON) {NAME}
    \end{lstlisting}
  \end{itemize}

  \vspace{-10pt}
  \begin{tiny}
  \begin{table}
    \caption{D1}
    \begin{tabular}{|l|}\hline
\underline{NAME}     \\[2pt]\hline\hline
Arnold Schwarzenegger\\\hline
George Clooney       \\\hline
Jennifer Jason Leigh \\\hline
John Malkovich       \\\hline
Jude Law             \\\hline
Spike Jonze          \\\hline
Udo Kier             \\\hline
Uma Thurman          \\\hline
    \end{tabular}
  \end{table}
  \end{tiny}
\end{frame}

\subsection*{References}

\begin{frame}
  \frametitle{References}

  \begin{block}{Required Reading: Date}
    \begin{itemize}
      \item Chapter 7: Relational Algebra\\
        7.1. \alert{Introduction}\\
        7.2. \alert{Closure Revisited}\\
        7.4. \alert{The Original Algebra: Semantics}
    \end{itemize}
  \end{block}
\end{frame}

\lstset{language=FullSQL}

\section{SQL}

\subsection{Introduction}

\begin{frame}[fragile]
  \frametitle{Projection}

  \begin{itemize}
    \item selecting columns from a table:
    \begin{lstlisting}
SELECT [ ALL | DISTINCT ] column_name [, ...]
  FROM table_name
    \end{lstlisting}

    \pause
    \medskip
    \item duplicate rows are allowed
    \begin{itemize}
        \item \lstinline!ALL!: preserve duplicate rows (default)
        \item \lstinline!DISTINCT!: take only one of duplicate rows
    \end{itemize}

    \medskip
    \item \lstinline!*!: all columns
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item all data of all movies
    \begin{lstlisting}
SELECT * FROM MOVIE
    \end{lstlisting}

    \pause
    \item titles and years of all movies
    \begin{lstlisting}
SELECT TITLE, YR FROM MOVIE
    \end{lstlisting}

    \pause
    \item years when movies were released
    \begin{lstlisting}
SELECT DISTINCT YR FROM MOVIE
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Ordering Results}

  \begin{itemize}
    \item ordering the rows in the result
    \begin{lstlisting}
SELECT [ ALL | DISTINCT ] column_name [, ...]
  FROM table_name
  [ ORDER BY { column_name [ ASC | DESC ] }
      [, ...] ]
    \end{lstlisting}

    \medskip
    \item \lstinline!ASC!: in ascending order (default)
    \item \lstinline!DESC!: in descending order
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item years when movies were released, in ascending order
    \begin{lstlisting}
SELECT DISTINCT YR FROM MOVIE
  ORDER BY YR
    \end{lstlisting}

    \pause
    \item years when movies were released, in descending order
    \begin{lstlisting}
SELECT DISTINCT YR FROM MOVIE
  ORDER BY YR DESC
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item all data of movies ordered first by descending years\\
      then by ascending titles
    \begin{lstlisting}
SELECT * FROM MOVIE
  ORDER BY YR DESC, TITLE ASC
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Column Expressions}

  \begin{itemize}
    \item evaluating expressions over columns
    \begin{lstlisting}
SELECT [ ALL | DISTINCT ]
  { expression [ AS column_name ] } [, ...]
  FROM table_name
  [ ORDER BY { column_name [ ASC | DESC ] }
      [, ...] ]
    \end{lstlisting}

    \medskip
    \item new columns can be named: \lstinline!AS!
    \item name or index of column can be used for ordering
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles and total scores of all movies
    \begin{lstlisting}
SELECT TITLE, SCORE * VOTES
  FROM MOVIE
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles and total scores of all movies,\\
      in descending order of total scores
    \begin{lstlisting}
SELECT TITLE, SCORE * VOTES AS POINTS
  FROM MOVIE
  ORDER BY POINTS DESC
    \end{lstlisting}

    \pause
    \begin{lstlisting}
SELECT TITLE, SCORE * VOTES
  FROM MOVIE
  ORDER BY 2 DESC
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Selection}

  \begin{itemize}
    \item selecting rows from a table
    \begin{lstlisting}
SELECT [ ALL | DISTINCT ]
  { expression [ AS column_name ] } [, ...]
  FROM table_name
  [ WHERE condition ]
  [ ORDER BY { column_name [ ASC | DESC ] }
      [, ...] ]
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item year of ``Citizen Kane''
    \begin{lstlisting}
SELECT YR FROM MOVIE
  WHERE (TITLE = 'Citizen Kane')
    \end{lstlisting}

    \pause
    \item titles of movies with scores less than 3\\
      and votes more than 10
    \begin{lstlisting}
SELECT TITLE FROM MOVIE
  WHERE ((SCORE < 3) AND (VOTES > 10))
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Condition Expressions}

  \begin{itemize}
    \item check if null:\\
    \begin{lstlisting}
column_name IS { NULL | NOT NULL }
    \end{lstlisting}

    \pause
    \medskip
    \item set membership:\\
    \begin{lstlisting}
column_name IN (value_set)
    \end{lstlisting}

    \pause
    \medskip
    \item string comparison:
    \begin{lstlisting}
column_name LIKE pattern
    \end{lstlisting}
    \item \lstinline!%!: matches any group of symbols, including empty string
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles of movies with unknown year
    \begin{lstlisting}
SELECT TITLE FROM MOVIE
  WHERE (YR IS NULL)
    \end{lstlisting}

    \pause
    \item titles and years of movies in the years 1967, 1954 and 1988
    \begin{lstlisting}
SELECT TITLE, YR FROM MOVIE
  WHERE (YR IN (1967, 1954, 1988))
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles and scores of ``Police Academy'' movies
    \begin{lstlisting}
SELECT TITLE, SCORE FROM MOVIE
  WHERE (TITLE LIKE 'Police Academy%')
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Grouping}

  \begin{itemize}
    \item grouping selected rows
    \begin{lstlisting}
SELECT [ ALL | DISTINCT ]
  { expression [ AS column_name ] } [, ...]
  FROM table_name
  [ WHERE condition ]
  [ GROUP BY column_name [, ...] ]
  [ HAVING condition ]
  [ ORDER BY { column_name [ ASC | DESC ] }
      [, ...] ]
    \end{lstlisting}

    \medskip
    \item result contains one row per group
    \item groups can be filtered: \lstinline!HAVING!
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Processing Order}

  \begin{itemize}
    \item select the rows that satisfy the \lstinline!WHERE! condition

    \pause
    \item group the selected rows using the columns\\
      specified in the \lstinline!GROUP BY! clause
    \begin{itemize}
      \item if no group, the entire result is one group
    \end{itemize}

    \pause
    \item select the groups that satisfy the \lstinline!HAVING! condition

    \pause
    \item calculate the expressions in the column list

    \pause
    \item order the result on the columns
      specified in the \lstinline!ORDER BY! clause
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Group Values}

  \begin{itemize}
    \item one value for each group
    \item column used for grouping
    \item result of an aggregate function on a column

    \pause
    \medskip
    \item aggregate functions: \lstinline!COUNT SUM AVG MAX MIN!
    \item column name as parameter
    \item null values are ignored
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item for every year, the number of movies\\
      with score greater than 8.5 in that year
    \begin{lstlisting}
SELECT YR, COUNT(ID) FROM MOVIE
  WHERE (SCORE > 8.5)
  GROUP BY YR
    \end{lstlisting}

    \pause
    \item score of the favorite movie of every year,\\
      in ascending order of years
    \begin{lstlisting}
SELECT YR, MAX(SCORE) FROM MOVIE
  GROUP BY YR
  ORDER BY YR
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item total number of votes
    \begin{lstlisting}
SELECT SUM(VOTES) FROM MOVIE
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item averages of movie scores\\
      in the years where there are at least 25 movies\\
      for which more than 40 people have voted,\\
      in ascending order of years

\medskip
\lstinline!SELECT! \uncover<5->{\lstinline!YR, AVG(SCORE)!\\}
~~~~\lstinline!FROM MOVIE!\\
\pause
~~~~\lstinline!WHERE (VOTES > 40)!\\
\pause
~~~~\lstinline!GROUP BY YR!\\
\pause
~~~~\lstinline!HAVING (COUNT(ID) >= 25)!\\
\pause\pause
~~~~\lstinline!ORDER BY YR!
  \end{itemize}
\end{frame}

\subsection{Join}

\begin{frame}
  \frametitle{Join}

  \begin{itemize}
    \item joining can be achieved using \lstinline!WHERE! conditions
    \item list tables to join \lstinline!FROM! clause
    \item use dotted notation for columns with identical names

    \pause
    \medskip
    \item processing order (conceptual):
    \begin{itemize}
      \item take Cartesian product of the tables
      \item select rows that satisfy the \lstinline!WHERE! condition
      \item \ldots
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item name of the director of ``Star Wars''
    \begin{lstlisting}
SELECT PERSON.NAME
  FROM MOVIE, PERSON
  WHERE ((MOVIE.DIRECTORID = PERSON.ID)
     AND (MOVIE.TITLE = 'Star Wars'))
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item names of the actors in ``Alien''
     \begin{lstlisting}
SELECT PERSON.NAME
  FROM MOVIE, PERSON, CASTING
  WHERE ((MOVIE.TITLE = 'Alien')
     AND (CASTING.MOVIEID = MOVIE.ID)
     AND (CASTING.ACTORID = PERSON.ID))
      \end{lstlisting}
    \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles of Harrison Ford's movies
    \begin{lstlisting}
SELECT MOVIE.TITLE
  FROM MOVIE, PERSON, CASTING
  WHERE ((PERSON.NAME = 'Harrison Ford')
     AND (CASTING.MOVIEID = MOVIE.ID)
     AND (CASTING.ACTORID = PERSON.ID))
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles and names of the lead actors of the movies in 1962
    \begin{lstlisting}
SELECT MOVIE.TITLE, PERSON.NAME
  FROM MOVIE, PERSON, CASTING
  WHERE ((MOVIE.YR = 1962)
     AND (CASTING.MOVIEID = MOVIE.ID)
     AND (CASTING.ACTORID = PERSON.ID)
     AND (CASTING.ORD = 1))
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item number of movies John Travolta acted in every year

    \medskip
\lstinline!SELECT! \uncover<4->{\lstinline!MOVIE.YR, COUNT(MOVIEID)!\\}
~~~~\lstinline!FROM MOVIE, PERSON, CASTING!\\
\pause
~~~~\lstinline!WHERE ((PERSON.NAME = 'John Travolta')!\\
~~~~~~~~~\lstinline!AND (CASTING.MOVIEID = MOVIE.ID)!\\
~~~~~~~~~\lstinline!AND (CASTING.ACTORID = PERSON.ID))!\\
\pause
~~~~\lstinline!GROUP BY MOVIE.YR!
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles and number of actors of the movies in 1978,\\
      in descending order of actor counts

    \medskip
\lstinline!SELECT! \uncover<4->{\lstinline!MOVIE.TITLE, COUNT(CASTING.ACTORID)!}\\
~~~~\lstinline!FROM MOVIE, CASTING!\\
\pause
~~~~\lstinline!WHERE ((MOVIE.YR = 1978)!\\
~~~~~~~~~\lstinline!AND (MOVIE.ID = CASTING.MOVIEID))!\\
\pause
~~~~\lstinline!GROUP BY MOVIE.MOVIEID, MOVIE.TITLE!\\
\pause\pause
~~~~\lstinline!ORDER BY 2 DESC!
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Table Expressions}

  \begin{itemize}
    \item joins can be expressed as table expressions:
    \begin{lstlisting}
SELECT ...
  FROM table_expression [ AS table_name ]
  WHERE selection_condition
  ...
    \end{lstlisting}

    \medskip
    \item product
    \item using conditions
    \item over columns with the same name
    \item natural join
    \item outer join
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Expressions}

  \begin{itemize}
    \item product
    \begin{lstlisting}
SELECT ...
  FROM table1_name CROSS JOIN table2_name
  ...
    \end{lstlisting}

    \pause
    \medskip
    \item join using conditions
    \begin{lstlisting}
SELECT ...
  FROM table1_name JOIN table2_name
         ON condition
  ...
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item name of the director of ``Star Wars''
    \begin{lstlisting}
SELECT PERSON.NAME
  FROM MOVIE, PERSON
  WHERE ((MOVIE.DIRECTORID = PERSON.ID)
     AND (MOVIE.TITLE = 'Star Wars'))
    \end{lstlisting}

    \pause
    \begin{lstlisting}
SELECT PERSON.NAME
  FROM MOVIE JOIN PERSON
          ON (MOVIE.DIRECTORID = PERSON.ID)
  WHERE (MOVIE.TITLE = 'Star Wars')
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Join Expressions}

  \begin{itemize}
    \item over columns with the same name
    \begin{lstlisting}
SELECT ...
  FROM table1_name JOIN table2_name
         USING (column_name [, ...])
  ...
    \end{lstlisting}
    \item repeated columns are taken once

    \pause
    \medskip
    \item natural join
    \begin{lstlisting}
SELECT ...
  FROM table1_name NATURAL JOIN table2_name
  ...
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Outer Join}

  \begin{itemize}
    \item inner join: unmatched rows are excluded

    \medskip
    \item \alert{outer join}: unmatched rows are included
    \item columns from the other table are null
    \begin{lstlisting}
SELECT ...
  FROM table1_name [ LEFT | RIGHT | FULL ]
         [ OUTER ] JOIN table2_name
  ...
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Outer Join Examples}

  \begin{itemize}
    \item left outer join
    \begin{columns}[t]
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{T1}
        \begin{tabular}{|r|l|}\hline
NUM & NAME \\\hline\hline
  1 & a    \\\hline
  2 & b    \\\hline
  3 & c    \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{T2}
        \begin{tabular}{|r|l|}\hline
NUM & VALUE \\\hline\hline
  1 & xxx   \\\hline
  3 & yyy   \\\hline
  5 & zzz   \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}

    \pause
    \begin{center}
      \begin{tiny}
      \begin{table}
        \caption{SELECT * FROM T1 LEFT JOIN T2}
        \begin{tabular}{|r|l|r|l|}\hline
NUM & NAME & NUM & VALUE \\\hline\hline
  1 & a    &   1 & xxx   \\\hline
  2 & b    &     &       \\\hline
  3 & c    &   3 & yyy   \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{center}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Outer Join Examples}

  \begin{itemize}
    \item right outer join
    \begin{columns}[t]
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{T1}
        \begin{tabular}{|r|l|}\hline
NUM & NAME \\\hline\hline
  1 & a    \\\hline
  2 & b    \\\hline
  3 & c    \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{T2}
        \begin{tabular}{|r|l|}\hline
NUM & VALUE \\\hline\hline
  1 & xxx   \\\hline
  3 & yyy   \\\hline
  5 & zzz   \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}

    \pause
    \begin{center}
      \begin{tiny}
      \begin{table}
        \caption{SELECT * FROM T1 RIGHT JOIN T2}
        \begin{tabular}{|r|l|r|l|}\hline
NUM & NAME & NUM & VALUE \\\hline\hline
  1 & a    &   1 & xxx   \\\hline
  3 & c    &   3 & yyy   \\\hline
    &      &   5 & zzz   \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{center}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Outer Join Examples}

  \begin{itemize}
    \item full outer join
    \begin{columns}[t]
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{T1}
        \begin{tabular}{|r|l|}\hline
NUM & NAME \\\hline\hline
  1 & a    \\\hline
  2 & b    \\\hline
  3 & c    \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{T2}
        \begin{tabular}{|r|l|}\hline
NUM & VALUE \\\hline\hline
  1 & xxx   \\\hline
  3 & yyy   \\\hline
  5 & zzz   \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}

    \pause
    \begin{center}
      \begin{tiny}
      \begin{table}
        \caption{SELECT * FROM T1 FULL JOIN T2}
        \begin{tabular}{|r|l|r|l|}\hline
NUM & NAME & NUM & VALUE \\\hline\hline
  1 & a    &   1 & xxx   \\\hline
  2 & b    &     &       \\\hline
  3 & c    &   3 & yyy   \\\hline
    &      &   5 & zzz   \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{center}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles of movies with no known actors
    \begin{lstlisting}
SELECT MOVIE.TITLE
  FROM MOVIE LEFT JOIN CASTING
         ON (CASTING.MOVIEID = MOVIE.ID)
  WHERE (CASTING.ACTORID IS NULL)
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Self Join}

  \begin{itemize}
    \item how to join columns in the same table?
    \item give a new name to the table in the expression
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles of all movies with the same number of votes

    \medskip
    \lstinline!SELECT M1.TITLE, M2.TITLE!\\
    \lstinline!  FROM MOVIE AS M1, MOVIE AS M2!\\
    \lstinline!  WHERE (M1.VOTES = M2.VOTES)!\\
    \pause
    \lstinline!    AND (M1.ID < M2.ID)!
  \end{itemize}
\end{frame}

\subsection{Subqueries}

\begin{frame}[fragile]
  \frametitle{Subqueries}

  \begin{itemize}
    \item using subquery results in condition expressions
    \begin{lstlisting}
SELECT ...
  WHERE expression operator
      [ ALL | ANY ] (subquery)
  ...
    \end{lstlisting}

    \item result of subquery must be compatible
    \item \lstinline!ALL!: for all values from subquery
    \item \lstinline!ANY!: for at least one value from subquery
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles and scores of all movies with scores\\
      higher than that of ``Star Wars'', in descending order of scores

      \medskip
\uncover<3->{
\lstinline!SELECT TITLE, SCORE FROM MOVIE!\\
~~~~\lstinline!WHERE (!
}
\uncover<2->{
\lstinline!SCORE >!\\
~~~~~~~~\lstinline!(!
}
\lstinline!SELECT SCORE FROM MOVIE!\\
~~~~~~~~~~~~~~\lstinline!WHERE (TITLE = 'Star Wars')!
\uncover<2->{
\lstinline!)!\\
}
\uncover<3->{
\lstinline!) ORDER BY SCORE DESC!
}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles of movies with scores less than\\
      the scores of all ``Police Academy'' movies

    \medskip
\uncover<3->{
\lstinline!SELECT TITLE FROM MOVIE!\\
~~~~\lstinline!WHERE (!
}
\uncover<2->{
\lstinline!SCORE < ALL!\\
~~~~~~~~\lstinline!(!
}
\lstinline!SELECT SCORE FROM MOVIE!\\
~~~~~~~~~~~~~~\lstinline!WHERE (TITLE LIKE 'Police Academy%')!
\uncover<2->{
\lstinline!)!\\
}
\uncover<3->{
\lstinline!)!
}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item titles of movies with less votes\\
      than any movie made before 1930

    \medskip
\uncover<3->{
\lstinline!SELECT TITLE FROM MOVIE!\\
~~~~\lstinline!WHERE ((YR >= 1930) AND (!
}
\uncover<2->{
\lstinline!VOTES < ANY (!\\
~~~~~~~~\lstinline!(!
}
\lstinline!SELECT VOTES FROM MOVIE!\\
~~~~~~~~~~~~~~\lstinline!WHERE (YR < 1930)!
\uncover<2->{
\lstinline!)!\\
}
\uncover<3->{
\lstinline!))!
}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item names of actors who played with Johnny Depp

    \medskip
\uncover<2->{
\lstinline!SELECT PERSON.NAME FROM PERSON, CASTING!\\
~~~~\lstinline!WHERE ((CASTING.ACTORID = PERSON.ID)!\\
~~~~~~~~~\lstinline!AND (CASTING.MOVIEID IN (!\\
}
~~~~~~~~~~~~~~~~~\lstinline!SELECT CASTING.MOVIEID!\\
~~~~~~~~~~~~~~~~~~~~~\lstinline!FROM PERSON, CASTING!\\
~~~~~~~~~~~~~~~~~~~~~\lstinline!WHERE ((CASTING.ACTORID = PERSON.ID)!\\
~~~~~~~~~~~~~~~~~~~~~~~~~~\lstinline!AND (PERSON.NAME = 'Johnny Depp'))!\\
\uncover<2->{
\lstinline!) ))!
}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item names of actors with at least 10 lead roles

    \medskip
\uncover<4->{
\lstinline!SELECT NAME FROM PERSON!\\
~~~~\lstinline!WHERE (ID IN (!\\
}
~~~~~~~~~~~~\lstinline!SELECT ACTORID FROM CASTING!\\
~~~~~~~~~~~~~~~~\lstinline!WHERE (ORD = 1)!\\
\pause
~~~~~~~~~~~~~~~~\lstinline!GROUP BY ACTORID!\\
\pause
~~~~~~~~~~~~~~~~\lstinline!HAVING (COUNT(MOVIEID) >= 10)!\\
\uncover<4->{
\lstinline!) )!
}
  \end{itemize}
\end{frame}

\subsection{Set Operations}

\begin{frame}
  \frametitle{Set Operations}

  \begin{itemize}
    \item an operation on two subquery results

    \medskip
    \item intersection: \lstinline!INTERSECT!
    \item union: \lstinline!UNION!
    \item difference: \lstinline!EXCEPT!

    \medskip
    \item duplicate rows are not allowed in the result
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
  \item number of people who both directed and acted

  \medskip
\uncover<3->{
\lstinline!SELECT COUNT(*) FROM (!\\
}
\uncover<2->{
~~~~\lstinline!(!
}
\lstinline!SELECT DISTINCT DIRECTORID FROM MOVIE!
\uncover<2->{
\lstinline!)!\\
~~~~\lstinline!INTERSECT!\\
~~~~\lstinline!(!
}
\lstinline!SELECT DISTINCT ACTORID FROM CASTING!
\uncover<2->{
\lstinline!)!\\
}
\uncover<3->{
\lstinline!) AS DIRECTOR_ACTOR!
}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item number of people who worked in movies before 1930

    \medskip
\uncover<3->{
\lstinline!SELECT COUNT(*) FROM (!\\
}
\uncover<2->{
~~~~\lstinline!(!
}
\lstinline!SELECT DISTINCT DIRECTORID FROM MOVIE!\\
~~~~~~~~~~~\lstinline!WHERE (YR < 1930)!
\uncover<2->{
\lstinline!)!\\
~~~~\lstinline!UNION!\\
~~~~\lstinline!(!
}
\lstinline!SELECT DISTINCT ACTORID FROM CASTING!\\
~~~~~~~~~~~\lstinline!WHERE (MOVIEID IN!\\
~~~~~~~~~~~~~~~~~~~~~~~~\lstinline!( SELECT ID FROM MOVIE!\\
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\lstinline!WHERE (YR < 1930) ))!
\uncover<2->{
\lstinline!)!\\
}
\uncover<3->{
\lstinline!) AS OLD_MOVIE_PERSON_IDS!
}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Query Examples}

  \begin{itemize}
    \item number of directors who have not acted

    \medskip
\uncover<3->{
\lstinline!SELECT COUNT(*) FROM (!\\
}
\uncover<2->{
~~~~\lstinline!(!
}
\lstinline!SELECT DISTINCT DIRECTORID FROM MOVIE!
\uncover<2->{
\lstinline!)!\\
~~~~\lstinline!EXCEPT!\\
~~~~\lstinline!(!
}
\lstinline!SELECT DISTINCT ACTORID FROM CASTING!
\uncover<2->{
\lstinline!)!\\
}
\uncover<3->{
\lstinline!) AS DIRECTOR_ONLY!
}
  \end{itemize}
\end{frame}

\subsection*{References}

\begin{frame}
  \frametitle{References}

  \begin{block}{Required Reading: Date}
    \begin{itemize}
      \item Chapter 8: Relational Calculus
      \begin{itemize}
        \item 8.6. \alert{SQL Facilities}
      \end{itemize}

      \item Appendix B: \alert{SQL Expressions}
      \item Chapter 19: Missing Information
    \end{itemize}
  \end{block}

  \begin{block}{Supplementary Reference}
    \begin{itemize}
      \item A Gentle Introduction to SQL:\\
        \url{http://sqlzoo.net/}
    \end{itemize}
  \end{block}
\end{frame}

\end{document}
