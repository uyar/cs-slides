% Copyright (c) 2002-2012
%       H. Turgut Uyar <uyar@itu.edu.tr>
%       Şule Gündüz Öğüdücü <sgunduz@itu.edu.tr>
%
% These notes are licensed using the
% "Creative Commons Attribution-NonCommercial-ShareAlike License".
% You are free to copy, distribute and transmit the work, and to adapt the work
% as long as you attribute the authors, do not use it for commercial purposes,
% and any derivative work is under the same or a similar license.
%
% Read the full legal code at:
% http://creativecommons.org/licenses/by-nc-sa/3.0/

\documentclass[dvipsnames]{beamer}

\usepackage{ae}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[turkish]{babel}
\setbeamertemplate{navigation symbols}{}
\usepackage[labelformat=empty, aboveskip=1pt, belowskip=1pt]{caption}

\usepackage{listings}
\lstdefinelanguage{TutorialD}[]{}{
  morekeywords={AND, AS, BASE, BOOL, CAST_AS_, CAST_AS_RATIONAL, CHAR,
                CONSTRAINT, DELETE, DIVIDEBY, DROP, INSERT, INTEGER, INTERSECT,
                JOIN, KEY, MINUS, OR, PER, POSSREP, RATIONAL, RELATION, RENAME,
                THE_, TUPLE, TYPE, UNION, UPDATE, VAR, WHERE}
}
\lstdefinelanguage{FullSQL}[]{SQL}{
  morekeywords={BINARY, BOOLEAN, CYCLE, FINAL, INCREMENT, IS, LARGE, MAXVALUE,
                MINVALUE, NO_ACTION, OBJECT, REFERENCES, RENAME, SEQUENCE,
                START, TO, TYPE, VACUUM}
}
\lstset{basicstyle=\ttfamily, keywordstyle=\color{blue}, showstringspaces=false}

\mode<presentation>
{
  \usetheme{Warsaw}
  \usecolortheme[named=ForestGreen]{structure}
  \setbeamercovered{transparent}
}

\title{Veri Tabanı Sistemleri}
\subtitle{Bağıntı Modeli}

\author{H. Turgut Uyar \and Şule Öğüdücü}
\date{2002-2012}

\AtBeginSubsection[]{
  \begin{frame}<beamer>
    \frametitle{Konular}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}

\theoremstyle{definition}
\newtheorem{tanim}[theorem]{Tanım}

\theoremstyle{example}
\newtheorem{ornek}[theorem]{Örnek}

\theoremstyle{plain}

\pgfdeclareimage[width=2cm]{license}{../../license}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{License}

  \pgfuseimage{license}\hfill
  \copyright 2002-2012 T. Uyar, Ş. Öğüdücü

  \vfill
  \begin{tiny}
    You are free:
    \begin{itemize}
      \item to Share -- to copy, distribute and transmit the work
      \item to Remix -- to adapt the work
    \end{itemize}

    Under the following conditions:
    \begin{itemize}
      \item Attribution -- You must attribute the work in the manner specified by
        the author or licensor (but not in any way that suggests that they
        endorse you or your use of the work).

      \item Noncommercial -- You may not use this work for commercial purposes.

      \item Share Alike -- If you alter, transform, or build upon this work, you
        may distribute the resulting work only under the same or similar license
        to this one.
    \end{itemize}
  \end{tiny}

  \vfill
  Legal code (the full license):\\
  \url{http://creativecommons.org/licenses/by-nc-sa/3.0/}
\end{frame}

\begin{frame}
  \frametitle{Konular}
  \tableofcontents
\end{frame}

\lstset{language=TutorialD}

\section{Bağıntı Modeli}

\subsection{Giriş}

\begin{frame}
  \frametitle{Veri Modelleri}

  \begin{itemize}
    \item önceki modeller:
    \begin{itemize}
      \item ters liste
      \item hiyerarşik
      \item ağ
    \end{itemize}

    \pause
    \item bağıntı modeli:
    \begin{itemize}
      \item Dr. E. F. Codd, 1970
    \end{itemize}

    \pause
    \item sonraki modeller:
    \begin{itemize}
      \item nesne
      \item nesne / bağıntı
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Bağıntı Modeli}

  \begin{itemize}
    \item veri \alert{bağıntılar} şeklinde modellenir:\\
      $\alpha \subseteq A \times B \times C \times ...$

    \pause
    \medskip
    \item bağıntılar \alert{bağıntı değişkenlerine} atanır
    \item bağıntının her elemanı bir \alert{çoklu}
    \item elemanların her verisi bir \alert{nitelik}

    \pause
    \medskip
    \item bağıntılar tablolarla temsil edilir
    \begin{itemize}
      \item kullanıcı bütün veriyi tablolar şeklinde \emph{algılamalı}
      \item bağıntı $\rightarrow$ tablo, çoklu $\rightarrow$ satır,
        nitelik $\rightarrow$ sütun
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Bağıntı Örneği}

  \begin{ornek}[film bağıntısı]
    \begin{tiny}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|l|r|l|c|r|r|}\hline
TITLE                & YEAR & DIRECTOR      & SCORE & VOTES\\\hline\hline
Usual Suspects       & 1995 & Bryan Singer  &   8.7 &  3502\\\hline
Suspiria             & 1977 & Dario Argento &   7.1 &  1004\\\hline
Being John Malkovich & 1999 & Spike Jonze   &   8.3 & 13809\\\hline
...                  &  ... & ...           &   ... &   ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \pause
    \begin{itemize}
      \item bağıntı değişkeninin adı \texttt{MOVIE}
      \item \texttt{(Usual Suspects, 1995, Bryan Singer, 8.7, 3502)}\\
        film bağıntısının bir çoklusu
      \item \texttt{YEAR}, film bağıntısının bir niteliği
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Bağıntı Yapısı}

  \begin{block}{bağıntı başlığı}
    \begin{itemize}
      \item bağıntının nitelikleri kümesi
      \item veri tanımlama dili komutlarından etkilenir
    \end{itemize}
  \end{block}

  \pause
  \begin{block}{bağıntı gövdesi}
    \begin{itemize}
      \item bağıntıdaki çoklular kümesi
      \item veri işleme dili komutlarından etkilenir
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Bağıntı Yüklemi}

  \begin{tanim}
    \alert{bağıntı yüklemi}: bağıntının "anlamını" ifade eden cümle
  \end{tanim}

  \begin{itemize}
    \item her çoklu yükleme göre \emph{Doğru} ya da \emph{Yanlış} değerini alır
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Bağıntı Yüklemi Örneği}

  \begin{ornek}[film bağıntısının yüklemi]
    \begin{itemize}
      \item \texttt{TITLE} başlıklı film \texttt{YEAR} yılında,
        \texttt{DIRECTOR} tarafından\\
        çekilmiştir; verilen \texttt{VOTES} oyun ortalaması \texttt{SCORE}'dur.

      \pause
      \medskip
      \item \texttt{(Suspiria, 1977, Dario Argento, 1004, 7.1)}\\
        çoklusu doğrudur
      \item \texttt{(Suspiria, 1978, Dario Argento, 1004, 7.1)}\\
        çoklusu yanlıştır
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Çoklu Sırası}

  \begin{itemize}
    \item çokluların sırası önemsizdir
  \end{itemize}

  \pause
  \begin{ornek}
    \begin{itemize}
      \item şu iki bağıntı eşdeğerlidir:
    \end{itemize}

    \begin{columns}
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|l|l|}\hline
TITLE                & ...\\\hline\hline
Usual Suspects       & ...\\\hline
Suspiria             & ...\\\hline
Being John Malkovich & ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|l|l|}\hline
TITLE                & ...\\\hline\hline
Suspiria             & ...\\\hline
Being John Malkovich & ...\\\hline
Usual Suspects       & ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Nitelik Sırası}

  \begin{itemize}
    \item niteliklerin sırası önemsizdir
  \end{itemize}

  \pause
  \begin{ornek}
    \begin{itemize}
      \item şu iki bağıntı eşdeğerlidir:
    \end{itemize}

    \begin{columns}
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|l|r|l|}\hline
TITLE                & YEAR & ...\\\hline\hline
Usual Suspects       & 1995 & ...\\\hline
Suspiria             & 1977 & ...\\\hline
Being John Malkovich & 1999 & ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        %\caption{MOVIE}
        \begin{tabular}{|r|l|l|}\hline
YEAR & TITLE                & ...\\\hline\hline
1995 & Usual Suspects       & ...\\\hline
1977 & Suspiria             & ...\\\hline
1999 & Being John Malkovich & ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Nitelik Değerleri}

  \begin{itemize}
    \item niteliklere verilen değerler tek boyutlu olmalıdır
    \begin{itemize}
      \item dizi, liste, kayıt gibi değerlere izin verilmez
    \end{itemize}
  \end{itemize}

  \pause
  \begin{ornek}[birden fazla yönetmen]
    \begin{tiny}
    \begin{table}
      %\caption{MOVIE}
      \begin{tabular}{|l|c|l|c|}\hline
TITLE  & ... & DIRECTORS                      & ...\\\hline\hline
...    & ... & ...                            & ...\\\hline
Matrix & ... & Andy Wachowski, Lana Wachowski & ...\\\hline
...    & ... & ...                            & ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \pause
    \begin{picture}(90,5)(-123,-29)
      \color[rgb]{1,0.2,0.1}
      \thicklines
      \only<3->{
        \put(0,0){\line(1,0){90}}
      }
    \end{picture}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Boş Değer}

  \begin{columns}[t]
    \column{.5\textwidth}
    \begin{itemize}
      \item çoklu için o niteliğin\\
	değeri bilinmiyor
    \end{itemize}

    \begin{ornek}
      \begin{itemize}
        \item filmin yönetmeni bilinmiyor
      \end{itemize}
    \end{ornek}

    \pause
    \column{.5\textwidth}
    \begin{itemize}
      \item çoklu o nitelik için\\
	bir değer taşımıyor
    \end{itemize}

    \begin{ornek}
      \begin{itemize}
        \item film için oy kullanılmamış,\\
          o yüzden \texttt{SCORE} yok
      \end{itemize}
    \end{ornek}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Varsayılan Değer}

  \begin{itemize}
    \item boş değer yerine varsayılan bir değer kullanılabilir
    \begin{itemize}
      \item niteliğin alabileceği geçerli değerlerden biri olmamalı
    \end{itemize}
  \end{itemize}

  \pause
  \begin{ornek}
    \begin{itemize}
      \item \texttt{SCORE} niteliği 1.0 ile 10.0 arasında değer alıyorsa\\
	varsayılan değeri \texttt{0.0} seçilebilir
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Eş Çoklular}

  \begin{itemize}
    \item bir bağıntıda birbirinin eşi çoklular bulunamaz
    \begin{itemize}
      \item her çoklu diğerlerinden ayırt edilebilmelidir
    \end{itemize}
  \end{itemize}

  \pause
  \begin{ornek}
    \begin{tiny}
    \begin{table}
      %\caption{MOVIE}
      \begin{tabular}{|l|r|l|c|r|r|}\hline
TITLE                & YEAR & DIRECTOR      & SCORE & VOTES\\\hline\hline
Usual Suspects       & 1995 & Bryan Singer  &   8.7 &  3502\\\hline
Suspiria             & 1977 & Dario Argento &   7.1 &  1004\\\hline
Being John Malkovich & 1999 & Spike Jonze   &   8.3 & 13809\\\hline
...                  &  ... & ...           &   ... &   ...\\\hline
Suspiria             & 1977 & Dario Argento &   7.1 &  1004\\\hline
...                  &  ... & ...           &   ... &   ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{ornek}

  \begin{picture}(20,40)(0,-63)
    \color[rgb]{1,0.2,0.1}
    \put(20,20){\vector(2,-1){25}}
    \put(20,20){\vector(2,1){25}}
  \end{picture}
\end{frame}

\begin{frame}
  \frametitle{Anahtarlar}

  \begin{itemize}
    \item $B$ bağıntının bütün nitelikleri kümesi olsun\\
      ve $A \subseteq B$ olsun

    \item $A$'nın bir anahtar adayı olabilmesi için\\
      şu koşullar sağlanmalı:

    \pause
    \begin{itemize}
      \item \alert{eşsizlik}: herhangi iki çoklu $A$'da yer alan\\
        bütün nitelikler için aynı değeri taşımazlar

      \pause
      \item \alert{indirgenemezlik}: $A$'nın hiçbir altkümesi\\
        eşsizlik özelliğini sağlamaz
    \end{itemize}

    \pause
    \item her bağıntının en az bir anahtar adayı vardır
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Anahtar Adayı Örneği}

  \begin{ornek}[film bağıntısı için anahtar adayları]
    \begin{itemize}
      \item \texttt{\{TITLE\}}

      \pause
      \item \texttt{\{TITLE, YEAR\}}

      \pause
      \item \texttt{\{TITLE, DIRECTOR\}}

      \pause
      \item \texttt{\{TITLE, YEAR, DIRECTOR\}}
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Anahtar Eşdeğeri}

  \begin{itemize}
    \item bir \alert{doğal anahtar} bulunamıyorsa\\
      bir \alert{anahtar eşdeğeri} tanımlanabilir

    \pause
    \medskip
    \item kimlik niteliği
    \begin{itemize}
      \item değerinin ne olduğunun önemi yok
      \item sistem tarafından üretilebilir
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Anahtar Eşdeğeri Örneği}

  \begin{ornek}
    \begin{tiny}
    \begin{table}
      %\caption{MOVIE}
      \begin{tabular}{|r|l|r|l|c|r|r|}\hline
MOVIE\# & TITLE                & YEAR & DIRECTOR      & SCORE & VOTES\\\hline\hline
    ... & ...                  &  ... & ...           & ...   &   ...\\\hline
      6 & Usual Suspects       & 1995 & Bryan Singer  & ...   &   ...\\\hline
   1512 & Suspiria             & 1977 & Dario Argento & ...   &   ...\\\hline
     70 & Being John Malkovich & 1999 & Spike Jonze   & ...   &   ...\\\hline
    ... & ...                  &  ... & ...           & ...   &   ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \pause
    \begin{itemize}
      \item \texttt{\{MOVIE\#\}} anahtar adayıdır
      \item \texttt{\{MOVIE\#, TITLE\}} anahtar adayı değildir
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Birincil Anahtar}

  \begin{itemize}
    \item bir bağıntının birden fazla anahtar adayı varsa:
    \begin{itemize}
      \item biri \alert{birincil anahtar} seçilir
      \item diğerleri \alert{anahtar seçeneği} olur
    \end{itemize}

    \pause
    \item her bağıntının bir birincil anahtarı bulunması zorunludur

    \pause
    \item birincil anahtarın parçası olan hiçbir niteliğin değeri\\
      hiçbir çokluda boş olamaz
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Birincil Anahtar Örneği}

  \begin{itemize}
    \item birincil anahtarı oluşturan nitelikler altı çizili gösterilir
  \end{itemize}

  \begin{ornek}
    \begin{tiny}
    \begin{table}
      %\caption{MOVIE}
      \begin{tabular}{|r|l|r|l|c|r|r|}\hline
\underline{MOVIE\#} & TITLE & YEAR & DIRECTOR      & SCORE & VOTES\\[2pt]\hline\hline
 ... & ...                  &  ... & ...           &   ... &   ...\\\hline
   6 & Usual Suspects       & 1995 & Bryan Singer  &   ... &   ...\\\hline
1512 & Suspiria             & 1977 & Dario Argento &   ... &   ...\\\hline
  70 & Being John Malkovich & 1999 & Spike Jonze   &   ... &   ...\\\hline
 ... & ...                  &  ... & ...           &   ... &   ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{ornek}
\end{frame}

\subsection{Veri Tipleri}

\begin{frame}
  \frametitle{Veri Tipleri}

  \begin{itemize}
    \item aynı niteliğe ilişkin değerler aynı tanım kümesinden seçilmeli
    \begin{itemize}
      \item karşılaştırma işlemi ancak aynı tanım kümesinden seçilmiş\\
        değerler arasında anlamlıdır
    \end{itemize}

    \pause
    \medskip
    \item pratikte veri tipleri kullanılır
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Tanım Kümesi Örneği}

  \begin{ornek}
    \begin{itemize}
      \item \texttt{TITLE} başlıklar kümesinden, \texttt{YEAR} yıllar
        kümesinden,\\
        \texttt{DIRECTOR} yönetmenler kümesinden, ...

      \pause
      \item veri tipi kullanılırsa:\\
        \texttt{TITLE} katar, \texttt{YEAR} tamsayı, \texttt{DIRECTOR} katar,
          ...

      \begin{itemize}
        \item \texttt{DIRECTOR} niteliğine \texttt{"Usual Suspects"} değerini
          vermek\\
          veri tipi açısından doğru, yüklem açısından yanlış

        \item \texttt{YEAR} ve \texttt{VOTES} değerleri birer tamsayı\\
          ancak bunları karşılaştırmak anlamlı değil
      \end{itemize}
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Tutorial D Veri Tipleri}

  \begin{itemize}
    \item \texttt{INTEGER}
    \item \texttt{RATIONAL}
    \item \texttt{BOOL}
    \item \texttt{CHAR}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tip Tanımlama}

  \begin{block}{Komut}
    \begin{lstlisting}
TYPE type_name POSSREP {
  field_name field_type
  [, ...]
};
    \end{lstlisting}
  \end{block}

  \pause
  \begin{block}{Tip Silme}
    \begin{lstlisting}
DROP TYPE type_name;
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tip Tanımlama Örnekleri}

  \begin{ornek}
    \begin{lstlisting}
TYPE MOVIE# POSSREP { VALUE INTEGER };

TYPE YEAR POSSREP { VALUE INTEGER };

TYPE SCORE POSSREP { VALUE RATIONAL };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tip İşlemleri}

  \begin{itemize}
    \item türetilen tip için değer üretme:
    \begin{lstlisting}
type_name(base_value [, ...])!
    \end{lstlisting}

    \pause
    \item bir alanın değerini alma: \lstinline!THE_! işleçleri
    \begin{lstlisting}
THE_field_name(variable_name)
    \end{lstlisting}

    \pause
    \item tip dönüşümü: \lstinline!CAST_AS_! işleçleri
    \begin{lstlisting}
CAST_AS_target_type(value)
    \end{lstlisting}

    \pause
    \item bir niteliğin adını değiştirme:
    \begin{lstlisting}
RENAME (attribute_name AS new_name)
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tip İşlemleri Örnekleri}

  \begin{ornek}
    \begin{itemize}
      \item bir \texttt{SCORE} değeri üretme:
      \begin{lstlisting}
SCORE(8.7)
      \end{lstlisting}

      \pause
      \item bir \texttt{SCORE} değişkeninin \texttt{VALUE} alanını alma:
      \begin{lstlisting}
THE_VALUE(SCORE)
      \end{lstlisting}

      \pause
      \item bir tamsayı \texttt{VOTES} değerini bir \texttt{RATIONAL} değere
        dönüştürme:
      \begin{lstlisting}
CAST_AS_RATIONAL(VOTES)
      \end{lstlisting}

      \pause
      \item \texttt{MOVIE\#} niteliğinin adını değiştirme:
      \begin{lstlisting}
RENAME (MOVIE# AS MOVIENO)
      \end{lstlisting}
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Değer Kısıtlamaları}

  \begin{block}{Komut}
    \begin{lstlisting}
TYPE type_name POSSREP {
  field_name field_type
  [, ...]
  CONSTRAINT condition
};
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Değer Kısıtlaması Örneği}

  \begin{example}
    \begin{itemize}
      \item \texttt{SCORE} değerleri \texttt{1.0} ile \texttt{10.0} arasında
        olmalı
    \end{itemize}

    \begin{lstlisting}
TYPE SCORE POSSREP {
  VALUE RATIONAL
  CONSTRAINT
    (VALUE >= 1.0) AND (VALUE <= 10.0)
};
    \end{lstlisting}
  \end{example}
\end{frame}

\subsection{Bağıntı Yönetimi}

\begin{frame}[fragile]
  \frametitle{Bağıntı Tanımlama}

  \begin{block}{Komut}
    \begin{lstlisting}
RELATION
  { attribute_name attribute_type
    [, ...] }
  KEY { attribute_name [, ...] }
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Bağıntı Tanımlama Örneği}

  \begin{ornek}
    \begin{lstlisting}
RELATION
  { MOVIE# MOVIE#,
    TITLE CHAR,
    YEAR YEAR,
    DIRECTOR CHAR,
    SCORE SCORE,
    VOTES INTEGER }
  KEY { MOVIE# }
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Taban Bağıntı Değişkeni Yaratma}

  \begin{block}{Komut}
    \begin{lstlisting}
VAR relvar_name BASE RELATION
  { ... }
  KEY { ... };
    \end{lstlisting}
  \end{block}

  \pause
  \begin{block}{Değişken Silme}
    \begin{lstlisting}
DROP VAR relvar_name;
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Taban Bağıntı Değişkeni Yaratma Örneği}

  \begin{ornek}
    \begin{lstlisting}
VAR MOVIE BASE RELATION
  { MOVIE# MOVIE#,
    TITLE CHAR,
    YEAR YEAR,
    DIRECTOR CHAR,
    SCORE SCORE,
    VOTES INTEGER }
  KEY { MOVIE# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Çoklu ve Bağıntı Üretme}

  \begin{block}{Çoklu Üretme}
    \begin{lstlisting}
TUPLE {
  attribute_name attribute_value
  [, ...]
}
    \end{lstlisting}
  \end{block}

  \pause
  \begin{block}{Bağıntı Üretme}
    \begin{lstlisting}
RELATION {
  TUPLE { ... }
  [, ...]
}
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Bağıntı Değişkenine Atama}

  \begin{itemize}
    \item bağıntıların bağıntı değişkenlerine atanması:
    \begin{lstlisting}
relvar_name := RELATION { ... };
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Bağıntı Değişkenine Atama Örneği}

  \begin{ornek}
    \begin{lstlisting}
MOVIE := RELATION {
  TUPLE { MOVIE# MOVIE#(6),
    TITLE "Usual Suspects",
    YEAR YEAR(1995), DIRECTOR "Bryan Singer",
    SCORE SCORE(8.7), VOTES 35027 },
  TUPLE { MOVIE# MOVIE#(70),
    TITLE "Being John Malkovich",
    YEAR YEAR(1999), DIRECTOR "Spike Jonze",
    SCORE SCORE(8.3), VOTES 13809 }
};
    \end{lstlisting}
  \end{ornek}
\end{frame}

\subsection{Veriyi Değiştirme}

\begin{frame}[fragile]
  \frametitle{Çoklu Ekleme}

  \begin{block}{Komut}
    \begin{lstlisting}
INSERT relvar_name RELATION {
  TUPLE { ... }
  [, ...]
};
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Çoklu Ekleme Örneği}

  \begin{ornek}
    \begin{lstlisting}
INSERT MOVIE RELATION {
  TUPLE { MOVIE# MOVIE#(6),
    TITLE "Suspiria",
    YEAR YEAR(1977),
    DIRECTOR "Dario Argento",
    SCORE SCORE(7.1), VOTES 1004 }
};
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Çoklu Silme}

  \begin{block}{Komut}
    \begin{lstlisting}
DELETE relvar_name
  [ WHERE condition ];
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item koşul belirtilmezse bütün çoklular silinir
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Çoklu Silme Örneği}

  \begin{ornek}
    \begin{itemize}
      \item puanı 3.0'dan düşük, oy sayısı 4'den fazla olan filmleri sil
    \end{itemize}

    \begin{lstlisting}
DELETE MOVIE
  WHERE ((SCORE < SCORE(3.0))
     AND (VOTES > 4));
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Çoklu Güncelleme}

  \begin{block}{Komut}
    \begin{lstlisting}
UPDATE relvar_name
  [ WHERE condition ]
  ( attribute_name := attribute_value
    [, ...] );
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item koşul belirtilmezse bütün çoklular güncellenir
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Çoklu Güncelleme Örneği}

  \begin{ornek}
    \begin{itemize}
      \item "Suspiria" filmi için yeni verilen bir oyu (9) işle
    \end{itemize}

    \begin{lstlisting}
UPDATE MOVIE
  WHERE (TITLE = "Suspiria") (
    SCORE := SCORE(
      (THE_VALUE(SCORE)
         * CAST_AS_RATIONAL(VOTES)
         + CAST_AS_RATIONAL(9))
       / CAST_AS_RATIONAL(VOTES + 1)
    ),
    VOTES := VOTES + 1
  );
    \end{lstlisting}
  \end{ornek}
\end{frame}

\subsection{Başvuru Bütünlüğü}

\begin{frame}
  \frametitle{Tek Boyutlu Değerler}

  \begin{itemize}
    \item değerlerin tek boyutlu olması kuralına uyabilmek için\\
      çokluların yinelenmeleri gerekebilir
  \end{itemize}
  
  \begin{ornek}[oyuncular nasıl tutulacak?]
    \begin{tiny}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|l|}\hline
\underline{MOVIE\#} & TITLE    & ... & ACTORS                      \\[2pt]\hline\hline
      6 & Usual Suspects       & ... & Gabriel Byrne               \\\hline
    ... & ...                  & ... & ...                         \\\hline
     70 & Being John Malkovich & ... & Cameron Diaz, John Malkovich\\\hline
    ... & ...                  & ... & ...                         \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \pause
    \begin{picture}(90,5)(-173,-29)
      \color[rgb]{1,0.2,0.1}
      \thicklines
      \only<2->{
        \put(0,0){\line(1,0){90}}
      }
    \end{picture}

    \pause
    \vspace{-25pt}
    \begin{tiny}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|l|}\hline
MOVIE\# & TITLE                & ... & ACTOR         \\\hline\hline
      6 & Usual Suspects       & ... & Gabriel Byrne \\\hline
    ... & ...                  & ... & ...           \\\hline
     70 & Being John Malkovich & ... & Cameron Diaz  \\\hline
     70 & Being John Malkovich & ... & John Malkovich\\\hline
    ... & ...                  & ... & ...           \\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Tek Boyutluluk Örneği}

  \begin{ornek}[filmler ve oyuncular]
    \begin{tiny}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|}\hline
\underline{MOVIE\#} & TITLE                & ...\\[2pt]\hline\hline
                  6 & Usual Suspects       & ...\\\hline
               1512 & Suspiria             & ...\\\hline
                 70 & Being John Malkovich & ...\\\hline
                ... & ...                  & ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \vspace{-12pt}
    \begin{columns}[t]
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{ACTOR}
        \begin{tabular}{|r|l|}\hline
\underline{ACTOR\#} & NAME          \\[2pt]\hline\hline
                308 & Gabriel Byrne \\\hline
                282 & Cameron Diaz  \\\hline
                503 & John Malkovich\\\hline
                ... & ...           \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{CASTING}
        \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
                  6 &                 308 &   2\\\hline
                 70 &                 282 &   2\\\hline
                 70 &                 503 &  14\\\hline
                ... &                 ... & ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Tek Boyutluluk Örneği}

  \begin{ornek}[yönetmenler nasıl tutulacak?]
    \begin{tiny}
    \begin{table}
      \caption{MOVIE}
      \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE                & ... & DIRECTOR\#\\[2pt]\hline\hline
                  6 & Usual Suspects       & ... &        639\\\hline
               1512 & Suspiria             & ... &       2259\\\hline
                 70 & Being John Malkovich & ... &       1485\\\hline
                ... & ...                  & ... &        ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}

    \vspace{-12pt}
    \begin{columns}[t]
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{PERSON}
        \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME          \\[2pt]\hline\hline
                 308 & Gabriel Byrne \\\hline
                1485 & Spike Jonze   \\\hline
                 639 & Bryan Singer  \\\hline
                 282 & Cameron Diaz  \\\hline
                2259 & Dario Argento \\\hline
                 503 & John Malkovich\\\hline
                 ... & ...           \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{CASTING}
        \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
                  6 &                 308 &   2\\\hline
                 70 &                 282 &   2\\\hline
                 70 &                 503 &  14\\\hline
                ... &                 ... & ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}
  \end{ornek}
\end{frame}

\begin{frame}
  \frametitle{Dış Anahtarlar}

  \begin{tanim}
    \alert{dış anahtar}: bir bağıntının bir niteliğinin\\
      başka bir bağıntının anahtar adayı olması
  \end{tanim}
\end{frame}

\begin{frame}
  \frametitle{Dış Anahtar Örnekleri}

  \begin{ornek}[\texttt{MOVIE} bağıntı değişkeninin \texttt{DIRECTOR\#} niteliği]
    \begin{columns}[t]
      \column{.63\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{MOVIE}
        \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\#\\[2pt]\hline\hline
   6 & Usual Suspects       & ... &        639\\\hline
1512 & Suspiria             & ... &       2259\\\hline
  70 & Being John Malkovich & ... &       1485\\\hline
 ... & ...                  & ... &        ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.37\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{PERSON}
        \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
 308 & Gabriel Byrne \\\hline
1485 & Spike Jonze   \\\hline
 639 & Bryan Singer  \\\hline
 282 & Cameron Diaz  \\\hline
2259 & Dario Argento \\\hline
 503 & John Malkovich\\\hline
 ... & ...           \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}
  \end{ornek}

  \begin{picture}(100,50)(-140,-90)
    \color[rgb]{0.1,0.6,0.1}
    \thicklines
    \only<2->{
      \put(22,22){\oval(20,8)}       % movie.director#=2259
      \put(101,0){\oval(20,8)}       % person.person#=2259
      \put(32,21){\vector(3,-1){58}} % movie.director#=2259->person.person#=2259
    }
    \only<3->{
      \put(10,41){\oval(45,9)}       % movie.director#
      \put(92,41){\oval(36,9)}       % person.person#
      \put(32,41){\vector(1,0){42}}  % movie.director#->person.person#
    }
  \end{picture}
\end{frame}

\begin{frame}
  \frametitle{Dış Anahtar Örnekleri}

  \begin{ornek}[film veri tabanındaki dış anahtarlar]
    \begin{columns}
      \column{.63\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{MOVIE}
        \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\#\\[2pt]\hline\hline
         6 & Usual Suspects & ... &        639\\\hline
      1512 & Suspiria       & ... &       2259\\\hline
       ... & ...            & ... &        ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.37\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{PERSON}
        \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
        308 & Gabriel Byrne\\\hline
       1485 & Spike Jonze  \\\hline
        ... & ...          \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}

    \begin{tiny}
    \begin{table}
      \caption{CASTING}
      \begin{tabular}{|r|r|r|}\hline
\underline{MOVIE\#} & \underline{ACTOR\#} & ORD\\[2pt]\hline\hline
                  6 &                 308 &   2\\\hline
                 70 &                 282 &   2\\\hline
                ... &                 ... & ...\\\hline
      \end{tabular}
    \end{table}
    \end{tiny}
  \end{ornek}

  \begin{picture}(210,80)(-25,-126)
    \color[rgb]{0.1,0.6,0.1}
    \thicklines
    \only<2->{
      \put(116,78){\oval(45,9)}        % movie.director#
      \put(211,78){\oval(36,9)}        % person.person#
      \put(138,78){\vector(1,0){54}}   % movie.director#->person.person#
    }
    \only<3->{
      \put(97,4){\oval(33,9)}          % casting.movie#
      \put(3,77){\oval(33,9)}          % movie.movie#
      \put(96,9){\vector(-4,3){83}}    % casting.movie#->movie.movie#
    }
    \only<4->{
      \put(136,4){\oval(35,9)}         % casting.actor#
      \put(150,9){\vector(3,4){48}}    % casting.actor#->person.person#
    }
  \end{picture}
\end{frame}

\begin{frame}
  \frametitle{Başvuru Bütünlüğü}

  \begin{tanim}
    \alert{başvuru bütünlüğü}:\\
      dış anahtar niteliğinin aldığı bütün değerler\\
      başvurulan bağıntının ilgili niteliğinde bulunmalı
  \end{tanim}

  \pause
  \begin{itemize}
    \item başvuru bütünlüğünü bozacak işlemler engellenmeli
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Başvuru Bütünlüğü Örneği}

  \begin{ornek}
    \begin{columns}
      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{MOVIE}
        \begin{tabular}{|r|l|c|r|}\hline
\underline{MOVIE\#} & TITLE & ... & DIRECTOR\#\\[2pt]\hline\hline
             ... & ...      & ... &        ...\\\hline
            1512 & Suspiria & ... &       2259\\\hline
             ... & ...      & ... &        ...\\\hline
        \end{tabular}
      \end{table}
      \end{tiny}

      \column{.5\textwidth}
      \begin{tiny}
      \begin{table}
        \caption{PERSON}
        \begin{tabular}{|r|l|}\hline
\underline{PERSON\#} & NAME\\[2pt]\hline\hline
        ... & ...          \\\hline
       2259 & Dario Argento\\\hline
        ... & ...          \\\hline
        \end{tabular}
      \end{table}
      \end{tiny}
    \end{columns}

    \pause
    \begin{itemize}
      \item \texttt{(2259, Dario Argento)} çoklusunu sil
      \item \texttt{(2259, Dario Argento)} çoklusunu\\
        \texttt{(2871, Dario Argento)} olarak değiştir
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Dış Anahtar Tanımlama}

  \begin{block}{Komut}
    \begin{lstlisting}
CONSTRAINT constraint_name
  referencing_relvar_name
      { attribute_name }
    <= referenced_relvar_name
        { attribute_name };
    \end{lstlisting}
  \end{block}

  \begin{itemize}
    \item iki bağıntıdaki nitelik isimlerinin aynı olması gerek
    \begin{itemize}
      \item değilse nitelik isimleri değiştirilmeli
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Dış Anahtar Tanımlama Örnekleri}

  \begin{ornek}[\texttt{CASTING} bağıntı değişkeninin \texttt{MOVIE\#} niteliği]
    \begin{lstlisting}
CONSTRAINT CASTING_FKEY_MOVIE
  CASTING { MOVIE# }
    <= MOVIE { MOVIE# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Dış Anahtar Tanımlama Örnekleri}

  \begin{ornek}[\texttt{MOVIE} bağıntı değişkeninin \texttt{DIRECTOR\#} niteliği]
    \begin{lstlisting}
CONSTRAINT MOVIE_FKEY_DIRECTOR
    MOVIE { DIRECTOR# }
        RENAME (DIRECTOR# AS PERSON#)
      <= PERSON { PERSON# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[tipler]
    \begin{lstlisting}
TYPE MOVIE# POSSREP { VALUE INTEGER };
TYPE YEAR POSSREP { VALUE INTEGER };
TYPE SCORE POSSREP { VALUE RATIONAL
  CONSTRAINT (VALUE >= 1.0)
         AND (VALUE <= 10.0) };
TYPE PERSON# POSSREP { VALUE INTEGER };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{MOVIE} bağıntı değişkeni]
    \begin{lstlisting}
VAR MOVIE BASE RELATION
  { MOVIE# MOVIE#, TITLE CHAR, YEAR YEAR,
    SCORE SCORE, VOTES INTEGER,
    DIRECTOR# PERSON# }
  KEY { MOVIE# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{PERSON} bağıntı değişkeni]
    \begin{lstlisting}
VAR PERSON BASE RELATION
    { PERSON# PERSON#, NAME CHAR }
    KEY { PERSON# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{CASTING} bağıntı değişkeni]
    \begin{lstlisting}
VAR CASTING BASE RELATION
    { MOVIE# MOVIE#, ACTOR# PERSON#,
      ORD INTEGER }
    KEY { MOVIE#, ACTOR# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{MOVIE} bağıntı değişkeninin dış anahtarları]
    \begin{lstlisting}
CONSTRAINT MOVIE_FKEY_DIRECTOR
  MOVIE { DIRECTOR# }
      RENAME (DIRECTOR# AS PERSON#)
    <= PERSON { PERSON# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{CASTING} bağıntı değişkeninin dış anahtarları]
    \begin{lstlisting}
CONSTRAINT CASTING_FKEY_MOVIE
  CASTING { MOVIE# } <= MOVIE { MOVIE# };

CONSTRAINT CASTING_FKEY_ACTOR
  CASTING { ACTOR# }
      RENAME (ACTOR# AS PERSON#)
    <= PERSON { PERSON# };
    \end{lstlisting}
  \end{ornek}
\end{frame}

\lstset{language=FullSQL}

\section{SQL}

\subsection{Veri Tipleri}

\begin{frame}
  \frametitle{Veri Tipleri}

  \begin{itemize}
    \item \texttt{INTEGER}
    \begin{itemize}
      \item \texttt{SMALLINT}
    \end{itemize}

    \pause
    \medskip
    \item \texttt{NUMERIC (precision, scale)}
    \begin{itemize}
      \item \texttt{precision}: toplam hane sayısı
      \item \texttt{scale}: noktadan sonraki hane sayısı
      \item eşanlamlısı: \texttt{DECIMAL (precision, scale)}
    \end{itemize}

    \pause
    \medskip
    \item \texttt{FLOAT (p)}
    \begin{itemize}
      \item \texttt{p}: kabul edilebilir en düşük duyarlık
    \end{itemize}

    \pause
    \medskip
    \item \texttt{BOOLEAN}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Katar Veri Tipleri}

  \begin{itemize}
    \item \texttt{CHARACTER [VARYING] (n)}
    \begin{itemize}
      \item \texttt{CHARACTER (n)} tipinde, katar \texttt{n} simgeden kısaysa\\
        sona boşluk eklenir
    \end{itemize}

    \pause
    \item kısaltmalar:
    \begin{itemize}
      \item \texttt{CHARACTER (n)} yerine \texttt{CHAR (n)}
      \item \texttt{CHARACTER VARYING (n)} yerine \texttt{VARCHAR (n)}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Tarih - Zaman Veri Tipleri}

  \begin{itemize}
    \item \texttt{DATE}
    \begin{itemize}
      \item değer örneği: \texttt{2005-09-26}
    \end{itemize}

    \pause
    \medskip
    \item \texttt{TIME}
    \begin{itemize}
      \item değer örneği: \texttt{11:59:22.078717}
    \end{itemize}

    \pause
    \medskip
    \item \texttt{TIMESTAMP}
    \begin{itemize}
      \item değer örneği: \texttt{2005-09-26 11:59:22.078717}
    \end{itemize}

    \pause
    \medskip
    \item \texttt{INTERVAL}
    \begin{itemize}
      \item değer örneği: \texttt{3 days}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Büyük Nesne Veri Tipleri}

  \begin{itemize}
    \item rasgele uzunluklu nesneler
    \item sorgulamada kullanılamaz

    \pause
    \bigskip
    \item metin: \texttt{CHARACTER LARGE OBJECT (n)}
    \begin{itemize}
      \item \texttt{CLOB}
    \end{itemize}

    \pause
    \item ikili: \texttt{BINARY LARGE OBJECT (n)}
    \begin{itemize}
      \item \texttt{BLOB}
      \item resim, ses v.b.
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tanım Kümesi Yaratma}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE DOMAIN domain_name [ AS ] base_type
  [ DEFAULT default_value ]
  [ { CHECK ( condition ) } [, ...] ]
    \end{lstlisting}
  \end{block}

  \pause
  \medskip
  \begin{block}{Tanım Kümesi Silme}
    \begin{lstlisting}
DROP DOMAIN domain_name [, ...]
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tanım Kümesi Örneği}

  \begin{ornek}[geçerli \texttt{SCORE} değerleri için bir tanım kümesi]
    \begin{lstlisting}
CREATE DOMAIN SCORES AS FLOAT
  CHECK ((VALUE >= 1.0) AND (VALUE <= 10.0))
    \end{lstlisting}
  \end{ornek}
\end{frame}

\subsection{Tablo Yönetimi}

\begin{frame}[fragile]
  \frametitle{Tablo Yaratma}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE TABLE table_name (
  { column_name data_type }
  [, ... ]
)
    \end{lstlisting}
  \end{block}

  \pause
  \medskip
  \begin{block}{Tablo Silme}
    \begin{lstlisting}
DROP TABLE table_name [, ... ]
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Boş ve Varsayılan Değerler}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE TABLE table_name (
  { column_name data_type
              [ NULL | NOT NULL ]
              [ DEFAULT default_value ] }
  [, ... ]
)
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item \texttt{NULL}: niteliğin boş bırakılmasına izin var (varsayılan)
    \item \texttt{NOT NULL}: niteliğin boş bırakılmasına izin yok
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Birincil Anahtar Tanımlama}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE TABLE table_name (
  { column_name data_type
              [ NULL | NOT NULL ]
              [ DEFAULT default_value ] }
  [, ... ]
  [ PRIMARY KEY ( column_name [, ...] ) ]
)
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item birincil anahtar tek bir sütundan oluşuyorsa,\\
      doğrudan sütun tanımında belirtilebilir:
      \begin{lstlisting}
column_name data_type PRIMARY KEY
      \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tablo Yaratma Örneği}

  \begin{ornek}
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER,
  TITLE VARCHAR(80) NOT NULL,
  YR NUMERIC(4),
  DIRECTOR VARCHAR(40),
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  PRIMARY KEY (ID)
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tablo Yaratma Örneği}

  \begin{ornek}
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  ...
  VOTES INTEGER DEFAULT 0
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Kendiliğinden Artırılan Değerler}

  \begin{itemize}
    \item ürüne özel tanımlar
    \begin{itemize}
      \item PostgreSQL: \texttt{SERIAL} veri tipi
      \item MySQL: \texttt{AUTO\_INCREMENT} özelliği
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Kendiliğinden Artırılan Değer Örnekleri}

  \begin{ornek}[PostgreSQL]
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID SERIAL PRIMARY KEY,
  ...
)
    \end{lstlisting}
  \end{ornek}

  \pause
  \begin{ornek}[MySQL]
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY AUTO_INCREMENT,
  ...
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Değer Kısıtlamaları}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE TABLE table_name (
  ...
  [ { CHECK ( condition ) }
    [, ...] ]
  ...
)
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Değer Kısıtlaması Örneği}

  \begin{ornek}
    \begin{itemize}
      \item \texttt{SCORE} değerleri \texttt{1.0} ile \texttt{10.0} arasında
        olmalı
    \end{itemize}

    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  ...,
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  CHECK ((SCORE >= 1.0) AND (SCORE <= 10.0))
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Eşsizlik Tanımı}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE TABLE table_name (
  ...
  [ { UNIQUE ( column_name [, ...] ) }
    [, ...] ]
  ...
)
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item eşsizlik kısıtlaması tek bir sütundan oluşuyorsa,\\
      doğrudan sütun tanımında belirtilebilir:
      \begin{lstlisting}
column_name data_type UNIQUE
      \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Eşsizlik Tanımı Örneği}

  \begin{ornek}
    \begin{itemize}
      \item \texttt{\{TITLE\}} ve \texttt{\{DIRECTOR, YR\}} eşsiz
    \end{itemize}

    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  TITLE VARCHAR(80) UNIQUE NOT NULL,
  YR NUMERIC(4),
  DIRECTOR VARCHAR(40),
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  UNIQUE (DIRECTOR, YR)
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tablo Adı Değiştirme}

  \begin{block}{Komut}
    \begin{lstlisting}
ALTER TABLE table_name
  RENAME TO new_name
    \end{lstlisting}
  \end{block}

  \pause
  \medskip
  \begin{ornek}
    \begin{lstlisting}
ALTER TABLE MOVIE
  RENAME TO FILM
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Sütun Ekleme}

  \begin{block}{Komut}
    \begin{lstlisting}
ALTER TABLE table_name
  ADD [ COLUMN ] column_name data_type
                 [ NULL | NOT NULL ]
                 [ DEFAULT default_value ]
    \end{lstlisting}
  \end{block}

  \pause
  \medskip
  \begin{ornek}
    \begin{lstlisting}
ALTER TABLE MOVIE
  ADD COLUMN RUNTIME INTEGER
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Sütun Silme}

  \begin{block}{Komut}
    \begin{lstlisting}
ALTER TABLE table_name
  DROP [ COLUMN ] column_name
    \end{lstlisting}
  \end{block}

  \pause
  \medskip
  \begin{ornek}
    \begin{lstlisting}
ALTER TABLE MOVIE
  DROP COLUMN RUNTIME
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Sütun Adı Değiştirme}

  \begin{block}{Komut}
    \begin{lstlisting}
ALTER TABLE table_name
  RENAME [ COLUMN ] column_name TO new_name
    \end{lstlisting}
  \end{block}

  \pause
  \medskip
  \begin{ornek}
    \begin{lstlisting}
ALTER TABLE MOVIE
  RENAME COLUMN TITLE TO NAME
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Sütun Varsayılan Değeri}

  \begin{block}{Sütun Varsayılan Değeri Değiştirme}
    \begin{lstlisting}
ALTER TABLE table_name
  ALTER [ COLUMN ] column_name
  SET DEFAULT default_value
    \end{lstlisting}
  \end{block}

  \pause
  \begin{block}{Sütun Varsayılan Değeri Silme}
    \begin{lstlisting}
ALTER TABLE table_name
  ALTER [ COLUMN ] column_name
  DROP DEFAULT
    \end{lstlisting}
  \end{block}
  \medskip
\end{frame}

\begin{frame}[fragile]
  \frametitle{Kısıtlama Ekleme}

  \begin{block}{Komut}
    \begin{lstlisting}
ALTER TABLE table_name
  ADD [ CONSTRAINT constraint_name ]
    constraint_definition
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item var olan çoklular ne olacak?
  \end{itemize}

  \pause
  \begin{block}{Kısıtlama Silme}
    \begin{lstlisting}
ALTER TABLE table_name
  DROP [ CONSTRAINT ] constraint_name
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Kısıtlama Ekleme Örneği}

  \begin{ornek}
    \begin{itemize}
      \item \texttt{YR} değerleri 1888'den küçük olamasın
    \end{itemize}

    \begin{lstlisting}
ALTER TABLE MOVIE
  ADD CONSTRAINT MINIMUM_YEAR
    CHECK (YR >= 1888)
    \end{lstlisting}

    \pause
    \begin{itemize}
      \item minimum yıl kısıtlamasını kaldır
    \end{itemize}

    \begin{lstlisting}
ALTER TABLE MOVIE
  DROP CONSTRAINT MINIMUM_YEAR
    \end{lstlisting}
  \end{ornek}
\end{frame}

\subsection{Veriyi Değiştirme}

\begin{frame}[fragile]
  \frametitle{Satır Ekleme}

  \begin{block}{Komut}
    \begin{lstlisting}
INSERT INTO table_name
  [ ( column_name [, ...] ) ]
  VALUES ( column_value [, ...] )
    \end{lstlisting}
  \end{block}

  \pause
  \begin{itemize}
    \item değer sırası sütun adı sırasına uymalıdır
    \item sütun adları belirtilmezse sütun değerleri\\
      tablo yaratılırken verilen sırayla yazılmalıdır
    \item belirtilmeyen sütunlara varsayılan değerleri atanır

    \pause
    \medskip
    \item otomatik üretilecek sütunları belirtmemek gerekir
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Satır Ekleme Örnekleri}

  \begin{ornek}
    \begin{lstlisting}
INSERT INTO MOVIE VALUES (
  6,
  'Usual Suspects',
  1995,
  'Bryan Singer',
  8.7,
  35027
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Satır Ekleme Örnekleri}

  \begin{ornek}
    \begin{lstlisting}
INSERT INTO MOVIE (YR, TITLE) VALUES (
  1995,
  'Usual Suspects'
)
    \end{lstlisting}

    \pause
    \begin{itemize}
      \item \texttt{ID} değeri otomatik üretilir
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Satır Silme}

  \begin{block}{Komut}
    \begin{lstlisting}
DELETE FROM table_name
  [ WHERE condition ]
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Satır Silme Örneği}

  \begin{ornek}
    \begin{itemize}
      \item puanı 3.0'dan düşük, oy sayısı 4'den fazla olan filmleri sil
    \end{itemize}

    \begin{lstlisting}
DELETE FROM MOVIE
  WHERE ((SCORE < 3.0) AND (VOTES > 4))
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Satır Güncelleme}

  \begin{block}{Komut}
    \begin{lstlisting}
UPDATE table_name
  SET { column_name = column_value } [, ...]
  [ WHERE condition ]
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Satır Güncelleme Örneği}

  \begin{ornek}
    \begin{itemize}
      \item "Suspiria" filmi için yeni verilen bir oyu (9) işle
    \end{itemize}

    \begin{lstlisting}
UPDATE MOVIE
  SET SCORE = (SCORE * VOTES + 9)
                  / (VOTES + 1),
      VOTES = VOTES + 1
  WHERE (TITLE = 'Suspiria')
    \end{lstlisting}
  \end{ornek}
\end{frame}

\subsection{Başvuru Bütünlüğü}

\begin{frame}[fragile]
  \frametitle{Dış Anahtar Tanımlama}

  \begin{block}{Komut}
    \begin{lstlisting}
CREATE TABLE table_name (
  ...
  [ { FOREIGN KEY ( column_name [, ...] )
        REFERENCES table_name
          [ ( column_name [, ...] ) ]
        [ ON DELETE option ]
        [ ON UPDATE option ] } [, ...] ]
  ...
)
    \end{lstlisting}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Başvuru Bütünlüğü Seçenekleri}

  \begin{itemize}
    \item işleme izin verme: \texttt{RESTRICT}, \texttt{NO\_ACTION}

    \pause
    \item işlemi etkilenen çoklulara yansıt: \texttt{CASCADE}

    \pause
    \item boş değer ata: \texttt{SET NULL}
    \begin{itemize}
      \item boş değer olmasına izin varsa
    \end{itemize}

    \pause
    \item varsayılan değer ata: \texttt{SET DEFAULT}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Bütünlük Kısıtlamaları Örnekleri}

  \begin{ornek}[silerken kısıtla]
    \begin{itemize}
      \item \texttt{PERSON} bağıntısından silinmek istenen\\
        yönetmenin \texttt{ID} niteliği değeri\\
        \texttt{MOVIE} bağıntısının \texttt{DIRECTORID} niteliği değerleri\\
        arasında geçiyorsa silmeye izin verme
    \end{itemize}
  \end{ornek}

  \pause
  \begin{ornek}[güncellerken yansıt]
    \begin{itemize}
      \item bir yönetmenin \texttt{ID} niteliği değeri\\
        \texttt{PERSON} bağıntısında güncellendiğinde\\
        \texttt{MOVIE} bağıntısının \texttt{DIRECTORID} niteliği değerlerinde\\
        geçtiği çoklularda da güncelle
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Bütünlük Kısıtlamaları Örnekleri}

  \begin{ornek}[silerken yansıt]
    \begin{itemize}
      \item kişiyi \texttt{PERSON} bağıntısından sil

      \pause
      \item \texttt{CASTING} bağıntısının \texttt{ACTORID} niteliğinde\\
        silinen kişinin \texttt{ID} niteliği değerinin geçtiği bütün çokluları
        sil

      \pause
      \item kişinin \texttt{ID} niteliği değerinin\\
        \texttt{MOVIE} bağıntısının \texttt{DIRECTORID} niteliğinde geçtiği\\
        bütün çokluları \texttt{MOVIE} bağıntısından sil

      \pause
      \item önceki adımda silinen her bir \texttt{MOVIE} çoklusu için\\
        \texttt{CASTING} bağıntısının \texttt{MOVIEID} niteliğinde\\
        silinen filmin \texttt{ID} niteliği değerinin geçtiği bütün çokluları sil
    \end{itemize}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Dış Anahtar Tanımlama Örneği}

  \begin{ornek}[\texttt{MOVIE} tablosunda \texttt{DIRECTORID} dış anahtarı]
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  ...
  DIRECTORID INTEGER,
  FOREIGN KEY DIRECTORID
    REFERENCES PERSON (ID)
    ON DELETE RESTRICT
    ON UPDATE CASCADE
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Dış Anahtar Tanımlama}

  \begin{itemize}
    \item dış anahtar, başvurulan tabloda birincil anahtarla eşleşiyorsa\\
      \texttt{REFERENCES} kısmında belirtilmesi zorunlu değildir

    \pause
    \medskip
    \item dış anahtar tek bir sütundan oluşuyorsa,\\
      sütun tanımında belirtilebilir:
    \begin{lstlisting}
column_name data_type
  REFERENCES table_name [ ( column_name ) ]
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{MOVIE} tablosunun yaratılması]
    \begin{lstlisting}
CREATE TABLE MOVIE (
  ID INTEGER PRIMARY KEY,
  TITLE VARCHAR(80) NOT NULL,
  YR NUMERIC(4),
  SCORE FLOAT,
  VOTES INTEGER DEFAULT 0,
  DIRECTORID INTEGER REFERENCES PERSON
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{PERSON} tablosunun yaratılması]
    \begin{lstlisting}
CREATE TABLE PERSON (
  ID INTEGER PRIMARY KEY,
  NAME VARCHAR(40) UNIQUE NOT NULL
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Örnek Veri Tabanının Yaratılması}

  \begin{ornek}[\texttt{CASTING} tablosunun yaratılması]
    \begin{lstlisting}
CREATE TABLE CASTING (
  MOVIEID INTEGER REFERENCES MOVIE,
  ACTORID INTEGER REFERENCES PERSON,
  ORD INTEGER,
  PRIMARY KEY (MOVIEID, ACTORID)
)
    \end{lstlisting}
  \end{ornek}
\end{frame}

\section*{Kaynaklar}

\begin{frame}
  \frametitle{Kaynaklar}

  \begin{block}{Okunacak: Date}
    \begin{itemize}
      \item Chapter 3: An Introduction to Relational Databases
      \begin{itemize}
        \item 3.2. \alert{An Informal Look at the Relational Model}
        \item 3.3. \alert{Relations and Relvars}
      \end{itemize}

      \item Chapter 6: \alert{Relations}

      \item Chapter 9: Integrity
      \begin{itemize}
        \item 9.10. \alert{Keys}
        \item 9.12. \alert{SQL Facilities}
      \end{itemize}
    \end{itemize}
  \end{block}
\end{frame}

\end{document}
