% Copyright (c) 2013-2014 H. Turgut Uyar <uyar@itu.edu.tr>
%
% This work is licensed under a "Creative Commons
% Attribution-NonCommercial-ShareAlike 4.0 International License".
% For more information, please visit:
% https://creativecommons.org/licenses/by-nc-sa/4.0/

\documentclass[dvipsnames]{beamer}

\usepackage[scaled=0.95]{cabin}
\usepackage[scaled=0.88]{beramono}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\usepackage{listings}
\lstset{basicstyle=\ttfamily,
        keywordstyle=\color{blue},
        showstringspaces=false}
\lstdefinestyle{syntax}{frame=single}
\lstdefinestyle{exclamfix}{deletestring=[b]{"}}
\lstset{language=Haskell}

\mode<presentation>
{
  \usetheme{default}
  \useinnertheme{rounded}
  \usecolortheme{seahorse}
  \setbeamercovered{transparent}
}

\title{Functional Programming}
\subtitle{Lists}

\author{H. Turgut Uyar}
\date{2013-2014}

\AtBeginSubsection[]{
  \begin{frame}<beamer>
    \frametitle{Topics}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}

\theoremstyle{plain}

\pgfdeclareimage[height=1cm]{license}{../license}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{License}

  \pgfuseimage{license}\hfill
  \copyright~2013-2014 H. Turgut Uyar

  \vfill
  \begin{footnotesize}
    You are free to:
    \begin{itemize}
      \itemsep0em
      \item Share -- copy and redistribute the material in any medium or format
      \item Adapt -- remix, transform, and build upon the material
    \end{itemize}

    Under the following terms:
    \begin{itemize}
      \itemsep0em
      \item Attribution -- You must give appropriate credit, provide a link to
        the license, and indicate if changes were made.

      \item NonCommercial -- You may not use the material for commercial
        purposes.

      \item ShareAlike -- If you remix, transform, or build upon the material,
        you must distribute your contributions under the same license as the
        original.
    \end{itemize}

    For more information:\\
    \url{https://creativecommons.org/licenses/by-nc-sa/4.0/}

    \smallskip
    Read the full license:\\
    \url{https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode}
  \end{footnotesize}
\end{frame}

\begin{frame}
  \frametitle{Topics}
  \tableofcontents
\end{frame}

\section{List Expressions}

\subsection{Strings}

\begin{frame}[fragile]
  \frametitle{Strings}

  \begin{itemize}
    \item a string is a list of characters
    \begin{lstlisting}
type String = [Char]
    \end{lstlisting}
  \end{itemize}

  \pause
  \begin{exampleblock}{examples}
    \begin{lstlisting}
head "word"   ~> 'w'
tail "word"   ~> "ord"
null "word"   ~> False
null ""       ~> True
length "word" ~> 4
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\subsection{List Operators}

\begin{frame}[fragile]
  \frametitle{Indexing}

  \begin{itemize}
    \item index operator: \lstinline|!!|\\
      \lstinline[style=exclamfix]|"word" !! 2 ~> 'r'|
    \item note that this is the same as:\\
      \lstinline[style=exclamfix]|(!!) "word" 2|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}
(!!) :: [a] -> Int -> a
(!!) []     _ = error "no such element"
(!!) (x:xs) 0 = x
(!!) (x:xs) n = (!!) xs (n - 1)
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Indexing}

  \begin{itemize}
    \item use the infix operator notation
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}
(!!) :: [a] -> Int -> a
[]     !! _ = error "no such element"
(x:xs) !! 0 = x
(x:xs) !! n = xs !! (n - 1)
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Appending Lists}

  \begin{itemize}
    \item append operator: \lstinline|++|\\
      \lstinline[style=exclamfix]|"word" ++ "smith"  ~> "wordsmith"|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}
(++) :: [a] -> [a] -> [a]
[]     ++ ys = ys
(x:xs) ++ ys = x : (xs ++ ys)
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\subsection{Ranges}

\begin{frame}[fragile]
  \frametitle{Range Expressions}

  \begin{itemize}
    \item \lstinline|[n .. m]|: range with increment 1
    \item \lstinline|[n, p .. m]|: range with increment \texttt{p - n}
  \end{itemize}

  \begin{exampleblock}{examples}
    \begin{lstlisting}
[2 .. 7]          ~> [2, 3, 4, 5, 6, 7]
[3.1 .. 7.0]      ~> [3.1, 4.1, 5.1, 6.1, 7.1]
['a' .. 'm']      ~> "abcdefghijklm"

[7, 6 .. 3]       ~> [7, 6, 5, 4, 3]
[0.0, 0.3 .. 1.0] ~> [0.0, 0.3, 0.6, 0.8999999999999999]
['a', 'c' .. 'n'] ~> "acegikm"
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Constructing Ranges}

  \begin{exampleblock}{construct a list from a lower limit to an upper limit}
    \begin{lstlisting}
countUp :: Integer -> Integer -> [Integer]
countUp lower upper
  | lower > upper = []
  | otherwise     = lower : countUp (lower + 1) upper
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: \lstinline|countDown| (tail recursive)
  \end{itemize}
\end{frame}

\subsection{List Comprehension}

\begin{frame}[fragile]
  \frametitle{List Comprehension}

  \begin{itemize}
    \item describe a list in terms of the elements of another list
    \item generate, test, transform
    \begin{lstlisting}[style=syntax]
[e | v1 <- l1, v2 <- l2, ..., p1, p2, ...]
    \end{lstlisting}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{List Comprehension Examples}

  \begin{exampleblock}{}
    \begin{lstlisting}
[2 * n | n <- [2, 4, 7]]  ~> [4, 8, 14]
[even n | n <- [2, 4, 7]] ~> [True, True, False]

[2 * n | n <- [2, 4, 7], even n, n > 3] ~> [8]

[m + n | (m, n) <- [(2, 3), (2, 1), (7, 8)]]
    ~> [5, 3, 15]

[(x, y, z) | x <- [1 .. 5], y <- [1 .. 5],
             z <- [1 .. 5],
             x*x + y*y == z*z]
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{List Comprehension Examples}

  \begin{exampleblock}{Python}
    \begin{lstlisting}[language=Python]
[2 * n for n in [2, 4, 7]]
[even(n) for n in [2, 4, 7]]

[2 * n for n in [2, 4, 7] if even(n) and (n > 3)]

[m + n for (m, n) in [(2, 3), (2, 1), (7, 8)]]

[(x, y, z) for x in range(1, 6)
           for y in range(1, 6)
           for z in range(1, 6)
           if x * x + y * y == z * z]
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{List Comprehension Example}

  \begin{exampleblock}{quick sort}
    \begin{lstlisting}
qSort :: [Integer] -> [Integer]
qSort []     = []
qSort (x:xs) =
    qSort smaller ++ [x] ++ qSort larger
      where
        smaller = [a | a <- xs, a <= x]
        larger  = [b | b <- xs, b >  x]
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\section{Prelude Functions}

\subsection{Basic Functions}

\begin{frame}[fragile]
  \frametitle{Membership Check}

  \begin{itemize}
    \item check whether an element is a member of a list\\
      \lstinline[style=exclamfix]|elem 'r' "word" ~> True|\\
      \lstinline[style=exclamfix]|elem 'x' "word" ~> False|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={elem}]
elem :: Char -> [Char] -> Bool
elem _ []     = False
elem x (c:cs) = if x == c then True else elem x cs
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: make a list of n copies of an item\\
      \lstinline|replicate 3 'c' ~> "ccc"|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Last Element}

  \begin{itemize}
    \item get the last element of a list\\
      \lstinline[style=exclamfix]|last "word" ~> 'd'|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={last}]
last :: [a] -> a
last []     = error "empty list"
last [x]    = x
last (x:xs) = last xs
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: get all elements but the last of a list\\
      \lstinline[style=exclamfix]|init "word" ~> "wor"|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Split}

  \begin{itemize}
    \item take n elements from the front of a list\\
      \lstinline[style=exclamfix]|take 3 "Peccary" ~> "Pec"|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={take}]
take :: Int -> [a] -> [a]
take 0 _      = []
take _ []     = []
take n (x:xs) = x : take (n - 1) xs
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: drop n elements from the front of a list\\
      \lstinline[style=exclamfix]|drop 3 "Peccary" ~> "cary"|

    \item exercise: split a list at a given position\\
      \lstinline[style=exclamfix]|splitAt 3 "Peccary" ~> ("Pec", "cary")|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Reverse}

  \begin{itemize}
    \item reverse a list\\
      \lstinline[style=exclamfix]|reverse "word" ~> "drow"|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={reverse}]
reverse :: [a] -> [a]
reverse []     = []
reverse (x:xs) = (reverse xs) ++ [x]
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Concatenate}

  \begin{itemize}
    \item convert a list of lists of items into a list of items\\
      \lstinline|concat [[2, 3], [], [4] ~> [2, 3, 4]|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={concat}]
concat :: [[a]] -> [a]
concat []       = []
concat (xs:xss) = xs ++ concat xss
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: write \lstinline|concat| using list comprehension
  \end{itemize}
\end{frame}

\subsection{Zip - Unzip}

\begin{frame}[fragile]
  \frametitle{Zip}

  \begin{itemize}
    \item convert two lists into a list of pairs\\
      \lstinline[style=exclamfix]|zip [1, 2] "ab" ~> [(1, 'a'), (2, 'b')]|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={zip}]
zip :: [a] -> [b] -> [(a, b)]
zip []     []     = []
zip (x:xs) (y:ys) = (x, y) : zip xs ys
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item not all cases are covered:\\
      \lstinline[style=exclamfix]|zip [1, 2] "abc" ~> [(1, 'a'), (2, 'b')]|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Zip}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={zip}]
zip :: [a] -> [b] -> [(a, b)]
zip (x:xs) (y:ys) = (x, y) : zip xs ys
zip _      _      = []
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: convert three lists into a list of triples\\
      \lstinline[style=exclamfix]|zip3 [1, 2] "abc" [7, 4]|\\
      \lstinline[style=exclamfix]|     ~> [(1, 'a', 7), (2, 'b', 4)]|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Unzip}

  \begin{itemize}
    \item convert a list of pairs into a pair of lists\\
      \lstinline[style=exclamfix]|unzip [(1, 'a'), (2, 'b')] ~> ([1, 2], "ab")|
  \end{itemize}

  \begin{exampleblock}{}
    \begin{lstlisting}[deletekeywords={unzip}]
unzip :: [(a, b)] -> ([a], [b])
unzip []           = ([], [])
unzip ((x, y):xys) = (x : xs, y : ys)
  where
    (xs, ys) = unzip xys
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: convert a list of triples into three lists\\
      \lstinline[style=exclamfix]|unzip3 [(1, 'a', 7), (2, 'b', 4)]|\\
      \lstinline[style=exclamfix]|     ~> ([1, 2], "ab", [7, 4])|
  \end{itemize}
\end{frame}

% TODO: add examples for zip/unzip, possibly also from Python

\subsection{Examples}

\begin{frame}[fragile]
  \frametitle{List Maximum}

  \begin{exampleblock}{maximum of a list}
    \begin{lstlisting}
maxList :: [Integer] -> Integer
maxList []         = error "empty list"
maxList [x]        = x
maxList (x:xs)
  | x > maxList xs = x
  | otherwise      = maxList xs
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item what if called as:\\
      \lstinline|maxList [30, 29 .. 1]|\\
      \lstinline|maxList [1 .. 30]|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{List Maximum}

  \begin{exampleblock}{maximum of a list}
    \begin{lstlisting}
maxList :: [Integer] -> Integer
maxList []      = error "empty list"
maxList [x]     = x
maxList (x:xs)
  | x > maxTail = x
  | otherwise   = maxTail
  where
    maxTail = maxList xs
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Merging Lists}

  \begin{exampleblock}{merge two ordered lists}
    \begin{lstlisting}
merge :: [Integer] -> [Integer] -> [Integer]
merge xs     []     = xs
merge []     ys     = ys
merge (x:xs) (y:ys)
  | x <= y          = x : merge xs (y : ys)
  | otherwise       = y : merge (x : xs) ys
    \end{lstlisting}
  \end{exampleblock}

  \begin{itemize}
    \item reconstructing original lists not necessary: \lstinline|@|
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Merging Lists}

  \begin{exampleblock}{merge two ordered lists}
    \begin{lstlisting}
merge :: [Integer] -> [Integer] -> [Integer]
merge xs          []          = xs
merge []          ys          = ys
merge xs@(x':xs') ys@(y':ys')
  | x' <= y'                  = x' : merge xs' ys
  | otherwise                 = y' : merge xs  ys'
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: check whether an integer list is in non-decreasing order
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Roman Numeral Conversion}


  \begin{exampleblock}{convert an integer to Roman numerals}
    \begin{itemize}
      \item adapted from the book ``Dive into Python'' by Mark Pilgrim:\\
        \url{http://www.diveintopython.net/}
    \end{itemize}

    \medskip
    \begin{lstlisting}
romanNumerals =
  [("M", 1000), ("CM", 900), ("D", 500), ("CD", 400),
   ("C",  100), ("XC",  90), ("L",  50), ("XL",  40),
   ("X",   10), ("IX",   9), ("V",   5), ("IV",   4),
   ("I",    1)]
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Roman Numeral Conversion}

  \begin{exampleblock}{Python}
    \begin{lstlisting}[language=Python]
def toRoman(n):
    result = ""
    for numeral, integer in romanNumerals:
        while n >= integer:
            result += numeral
            n -= integer
    return result
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Roman Numeral Conversion}

  \begin{exampleblock}{}
    \begin{lstlisting}
toRoman :: Integer -> String
toRoman n = tR n romanNumerals
  where
    tR :: Integer -> [(String, Integer)] -> String
    tR n []              = ""
    tR n xs@((s, k):xs')
      | n >= k           = s ++ tR (n - k) xs
      | otherwise        = tR n xs'
    \end{lstlisting}
  \end{exampleblock}

  \pause
  \begin{itemize}
    \item exercise: convert a Roman numeral string into an integer
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Roman Numeral Conversion}

  \begin{exampleblock}{Python}
    \begin{lstlisting}[language=Python]
def fromRoman(s):
    result = 0
    index = 0
    for numeral, integer in romanNumerals:
        while s[index : index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
    return result
    \end{lstlisting}
  \end{exampleblock}
\end{frame}

\section*{References}

\begin{frame}
  \frametitle{References}

  \begin{block}{Required Reading: Thompson}
    \begin{itemize}
      \item Chapter 6: \alert{Programming with lists}
      \item Chapter 7: \alert{Defining functions over lists}
    \end{itemize}
  \end{block}
\end{frame}

\end{document}
